<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® MaestroFin Crisis Sensor - Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.0/index.min.js"></script>
    <link rel="stylesheet" href="/static/dashboard_cyberpunk.css">
</head>
<body>
    <!-- Header Cyberpunk -->
    <div class="header">
        <h1>üö® MAESTROFIN CRISIS SENSOR</h1>
        <div class="subtitle">SISTEMA DE MONITORAMENTO AVAN√áADO</div>
    </div>

    <!-- Container Principal -->
    <div class="container">
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            gap: 1.5rem;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .metric-card {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #5a67d8;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            color: #6b7280;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-trend {
            font-size: 0.8rem;
            margin-top: 0.5rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }
        
        .trend-up {
            background: #dcfce7;
            color: #166534;
        }
        
        .trend-down {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }
        
        .chart-card {
            background: rgba(255,255,255,0.95);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #374151;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .data-table th,
        .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .data-table th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        .data-table tr:hover {
            background: #f9fafb;
        }
        
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: rgba(255,255,255,0.95);
            padding: 0.5rem;
            border-radius: 12px;
        }
        
        .tab-button {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .tab-button.active {
            background: #5a67d8;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #dc2626;
        }
        
        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }
        
        .user-activity {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #5a67d8;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        
        .spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #5a67d8;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .footer {
            text-align: center;
            padding: 2rem;
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .metrics-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
            .charts-grid { grid-template-columns: 1fr; }
            .header { flex-direction: column; gap: 1rem; }
        }
        
        .error-indicator {
            background: #fee2e2;
            color: #991b1b;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }
        
        .success-rate {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .success-high { background: #dcfce7; color: #166534; }
        .success-medium { background: #fef3c7; color: #92400e; }
        .success-low { background: #fee2e2; color: #991b1b; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üö® MAESTROFIN CRISIS SENSOR</h1>
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span>SISTEMA ATIVO ‚Ä¢ √öLTIMA VARREDURA: <span id="lastUpdate">--</span></span>
        </div>
    </div>
    
    <div class="container">
        <!-- Tabs de Navega√ß√£o -->
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('overview')">üìä OVERVIEW</button>
            <button class="tab-button" onclick="showTab('users')">üë• USU√ÅRIOS</button>
            <button class="tab-button" onclick="showTab('commands')">‚ö° COMANDOS</button>
            <button class="tab-button" onclick="showTab('performance')">üöÄ PERFORMANCE</button>
            <button class="tab-button" onclick="showTab('errors')">üö® ALERTAS</button>
        </div>
        
        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <!-- M√©tricas em Tempo Real -->
            <div class="metrics-grid" id="realtimeMetrics">
                <div class="loading">
                    <div class="spinner"></div>
                    INICIALIZANDO SENSORES...
                </div>
            </div>
            
            <!-- Gr√°ficos Principais -->
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üìà ATIVIDADE SISTEMA - 24H</h3>
                    <canvas id="activityChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üèÜ COMANDOS CR√çTICOS</h3>
                    <canvas id="commandsChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">‚ö° LAT√äNCIA SISTEMA</h3>
                    <canvas id="performanceChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üë§ USU√ÅRIOS EM ALERTA</h3>
                    <div class="user-activity" id="topUsers">
                        <div class="loading">ESCANEANDO USU√ÅRIOS...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Users Tab -->
        <div id="users" class="tab-content">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üë• USU√ÅRIOS MONITORADOS</h3>
                    <div class="tabs">
                        <button class="tab-button active" onclick="loadActiveUsers('24h')">24H</button>
                        <button class="tab-button" onclick="loadActiveUsers('7d')">7 DIAS</button>
                        <button class="tab-button" onclick="loadActiveUsers('30d')">30 DIAS</button>
                    </div>
                    <div id="activeUsersContent">
                        <div class="loading">Carregando usu√°rios ativos...</div>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üìä An√°lise de Reten√ß√£o</h3>
                    <canvas id="retentionChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Commands Tab -->
        <div id="commands" class="tab-content">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">‚ö° An√°lise Detalhada de Comandos</h3>
                    <div id="commandAnalysis">
                        <div class="loading">Carregando an√°lise de comandos...</div>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üìà Tend√™ncias de Comandos</h3>
                    <canvas id="commandTrendsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Performance Tab -->
        <div id="performance" class="tab-content">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üöÄ Performance por Comando</h3>
                    <div id="performanceAnalysis">
                        <div class="loading">Carregando an√°lise de performance...</div>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">‚è±Ô∏è Timeline de Performance</h3>
                    <canvas id="performanceTimelineChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Errors Tab -->
        <div id="errors" class="tab-content">
            <div class="charts-grid">
                <div class="chart-card">
                    <h3 class="chart-title">üö® An√°lise de Erros</h3>
                    <div id="errorAnalysis">
                        <div class="loading">Carregando an√°lise de erros...</div>
                    </div>
                </div>
                
                <div class="chart-card">
                    <h3 class="chart-title">üìä Erros por Comando</h3>
                    <canvas id="errorsByCommandChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>MaestroFin Analytics Dashboard ‚Ä¢ Atualiza√ß√£o autom√°tica a cada 30 segundos</p>
        <p>Desenvolvido com ‚ù§Ô∏è para an√°lise completa do seu bot</p>
    </div>

    <script>
        // Estado Global
        let charts = {};
        let refreshInterval;
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadOverviewData();
            startAutoRefresh();
        });
        
        // Gerenciamento de Tabs
        function showTab(tabName) {
            // Esconder todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tabs .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab selecionada
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Carregar dados espec√≠ficos da tab
            switch(tabName) {
                case 'overview':
                    loadOverviewData();
                    break;
                case 'users':
                    loadUsersData();
                    break;
                case 'commands':
                    loadCommandsData();
                    break;
                case 'performance':
                    loadPerformanceData();
                    break;
                case 'errors':
                    loadErrorsData();
                    break;
            }
        }
        
        // Carregar dados da vis√£o geral
        async function loadOverviewData() {
            try {
                // Carregar m√©tricas em tempo real
                const realtimeResponse = await fetch('/api/overview/realtime');
                const realtimeData = await realtimeResponse.json();
                displayRealtimeMetrics(realtimeData);
                
                // Carregar dados di√°rios
                const dailyResponse = await fetch('/api/stats/daily');
                const dailyData = await dailyResponse.json();
                
                // Atualizar gr√°ficos
                updateActivityChart(dailyData.hourly_activity);
                updateCommandsChart(dailyData.top_commands);
                updateTopUsers(dailyData.top_users);
                
                updateLastUpdateTime();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showError('Erro ao carregar dados da vis√£o geral');
            }
        }
        
        // Exibir m√©tricas em tempo real
        function displayRealtimeMetrics(data) {
            const container = document.getElementById('realtimeMetrics');
            const stats = data.realtime_stats;
            
            container.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${stats.last_30min.users || 0}</div>
                    <div class="metric-label">Usu√°rios (30min)</div>
                    <div class="metric-trend trend-up">+${stats.last_1hour.users || 0} (1h)</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value">${stats.last_30min.commands || 0}</div>
                    <div class="metric-label">Comandos (30min)</div>
                    <div class="metric-trend trend-up">+${stats.last_1hour.commands || 0} (1h)</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value">${Math.round(stats.last_30min.avg_response_time || 0)}ms</div>
                    <div class="metric-label">Tempo Resposta</div>
                    <div class="metric-trend ${(stats.last_30min.avg_response_time || 0) < 1000 ? 'trend-up' : 'trend-down'}">
                        √öltimos 30min
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value">${stats.last_24hours.errors || 0}</div>
                    <div class="metric-label">Erros (24h)</div>
                    <div class="metric-trend ${(stats.last_24hours.errors || 0) === 0 ? 'trend-up' : 'trend-down'}">
                        ${stats.last_1hour.errors || 0} (1h)
                    </div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value">${stats.last_week.users || 0}</div>
                    <div class="metric-label">Usu√°rios (Semana)</div>
                    <div class="metric-trend trend-up">Total √∫nico</div>
                </div>
                
                <div class="metric-card">
                    <div class="metric-value">${data.highlights.most_active_user?.username || 'N/A'}</div>
                    <div class="metric-label">Mais Ativo (1h)</div>
                    <div class="metric-trend trend-up">${data.highlights.most_active_user?.commands || 0} cmds</div>
                </div>
            `;
        }
        
        // Atualizar gr√°fico de atividade
        function updateActivityChart(hourlyData) {
            if (!hourlyData) return;
            
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            if (charts.activityChart) {
                charts.activityChart.destroy();
            }
            
            charts.activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: hourlyData.map(h => h.hour),
                    datasets: [{
                        label: 'Comandos por Hora',
                        data: hourlyData.map(h => h.commands),
                        borderColor: '#5a67d8',
                        backgroundColor: 'rgba(90, 103, 216, 0.1)',
                        tension: 0.4,
                        fill: true
                    }, {
                        label: 'Usu√°rios √önicos',
                        data: hourlyData.map(h => h.unique_users || 0),
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Atualizar gr√°fico de comandos
        function updateCommandsChart(commandsData) {
            if (!commandsData) return;
            
            const ctx = document.getElementById('commandsChart').getContext('2d');
            
            if (charts.commandsChart) {
                charts.commandsChart.destroy();
            }
            
            const topCommands = commandsData.slice(0, 10);
            
            charts.commandsChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: topCommands.map(c => c.command),
                    datasets: [{
                        data: topCommands.map(c => c.count),
                        backgroundColor: [
                            '#5a67d8', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                            '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#6366f1'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }
        
        // Atualizar lista de top usu√°rios
        function updateTopUsers(usersData) {
            const container = document.getElementById('topUsers');
            
            if (!usersData || usersData.length === 0) {
                container.innerHTML = '<div class="loading">Nenhum usu√°rio ativo hoje</div>';
                return;
            }
            
            container.innerHTML = usersData.map(user => `
                <div class="user-item">
                    <div class="user-info">
                        <div class="user-avatar">${(user.username || 'U').charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight: 600;">${user.username || `Usu√°rio ${user.user_id}`}</div>
                            <div style="font-size: 0.8rem; color: #6b7280;">ID: ${user.user_id}</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600; color: #5a67d8;">${user.commands_count}</div>
                        <div style="font-size: 0.8rem; color: #6b7280;">comandos</div>
                    </div>
                </div>
            `).join('');
        }
        
        // Carregar dados de usu√°rios
        async function loadUsersData() {
            loadActiveUsers('24h');
        }
        
        // Carregar usu√°rios ativos
        async function loadActiveUsers(period) {
            try {
                const response = await fetch(`/api/users/active?period=${period}`);
                const data = await response.json();
                displayActiveUsers(data);
            } catch (error) {
                console.error('Erro ao carregar usu√°rios:', error);
            }
        }
        
        // Exibir usu√°rios ativos
        function displayActiveUsers(data) {
            const container = document.getElementById('activeUsersContent');
            
            if (!data.users || data.users.length === 0) {
                container.innerHTML = '<div class="alert alert-info">Nenhum usu√°rio ativo no per√≠odo</div>';
                return;
            }
            
            container.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong>Total: ${data.total_active_users} usu√°rios ativos</strong>
                    <span style="color: #6b7280; margin-left: 1rem;">Per√≠odo: ${data.period}</span>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Usu√°rio</th>
                            <th>Comandos</th>
                            <th>√öltima Atividade</th>
                            <th>Taxa Sucesso</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.users.map(user => `
                            <tr>
                                <td>
                                    <div class="user-info">
                                        <div class="user-avatar">${(user.username || 'U').charAt(0).toUpperCase()}</div>
                                        <div>
                                            <div style="font-weight: 600;">${user.username || `Usu√°rio ${user.user_id}`}</div>
                                            <div style="font-size: 0.8rem; color: #6b7280;">ID: ${user.user_id}</div>
                                        </div>
                                    </div>
                                </td>
                                <td><strong>${user.commands_count}</strong></td>
                                <td>${formatDateTime(user.last_activity)}</td>
                                <td>
                                    <span class="success-rate ${getSuccessRateClass(
                                        (user.successful_commands / user.commands_count * 100)
                                    )}">
                                        ${Math.round(user.successful_commands / user.commands_count * 100 || 0)}%
                                    </span>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // Carregar dados de comandos
        async function loadCommandsData() {
            try {
                const response = await fetch('/api/commands/detailed?days=7');
                const data = await response.json();
                displayCommandAnalysis(data);
            } catch (error) {
                console.error('Erro ao carregar comandos:', error);
            }
        }
        
        // Exibir an√°lise de comandos
        function displayCommandAnalysis(data) {
            const container = document.getElementById('commandAnalysis');
            
            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Comando</th>
                            <th>Total</th>
                            <th>Usu√°rios</th>
                            <th>Tempo M√©dio</th>
                            <th>Taxa Sucesso</th>
                            <th>% de Uso</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.command_analysis.map(cmd => `
                            <tr>
                                <td><strong>${cmd.command}</strong></td>
                                <td>${cmd.total_uses}</td>
                                <td>${cmd.unique_users}</td>
                                <td>${Math.round(cmd.avg_execution_time || 0)}ms</td>
                                <td>
                                    <span class="success-rate ${getSuccessRateClass(cmd.success_rate)}">
                                        ${Math.round(cmd.success_rate || 0)}%
                                    </span>
                                </td>
                                <td>${Math.round(cmd.usage_percentage || 0)}%</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // Carregar dados de performance
        async function loadPerformanceData() {
            try {
                const response = await fetch('/api/performance/detailed?hours=24');
                const data = await response.json();
                displayPerformanceAnalysis(data);
            } catch (error) {
                console.error('Erro ao carregar performance:', error);
            }
        }
        
        // Exibir an√°lise de performance
        function displayPerformanceAnalysis(data) {
            const container = document.getElementById('performanceAnalysis');
            
            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Comando</th>
                            <th>Execu√ß√µes</th>
                            <th>Tempo M√©dio</th>
                            <th>Tempo Min</th>
                            <th>Tempo Max</th>
                            <th>P95</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.command_performance.map(perf => `
                            <tr>
                                <td><strong>${perf.command}</strong></td>
                                <td>${perf.total_executions}</td>
                                <td style="color: ${perf.avg_time > 2000 ? '#ef4444' : perf.avg_time > 1000 ? '#f59e0b' : '#10b981'}">
                                    ${Math.round(perf.avg_time || 0)}ms
                                </td>
                                <td>${Math.round(perf.min_time || 0)}ms</td>
                                <td>${Math.round(perf.max_time || 0)}ms</td>
                                <td>${Math.round(perf.p95_time || 0)}ms</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // Carregar dados de erros
        async function loadErrorsData() {
            try {
                const response = await fetch('/api/errors/detailed?days=7');
                const data = await response.json();
                displayErrorAnalysis(data);
            } catch (error) {
                console.error('Erro ao carregar erros:', error);
            }
        }
        
        // Exibir an√°lise de erros
        function displayErrorAnalysis(data) {
            const container = document.getElementById('errorAnalysis');
            
            if (!data.error_analysis || data.error_analysis.length === 0) {
                container.innerHTML = '<div class="alert alert-info">üéâ Nenhum erro nos √∫ltimos 7 dias!</div>';
                return;
            }
            
            container.innerHTML = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Tipo do Erro</th>
                            <th>Quantidade</th>
                            <th>Usu√°rios Afetados</th>
                            <th>Comandos Afetados</th>
                            <th>√öltima Ocorr√™ncia</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${data.error_analysis.map(error => `
                            <tr>
                                <td><strong>${error.error_type}</strong></td>
                                <td><span class="error-indicator">${error.error_count}</span></td>
                                <td>${error.affected_users}</td>
                                <td>${error.affected_commands}</td>
                                <td>${formatDateTime(error.last_occurrence)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        // Utilit√°rios
        function getSuccessRateClass(rate) {
            if (rate >= 95) return 'success-high';
            if (rate >= 80) return 'success-medium';
            return 'success-low';
        }
        
        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            return new Date(dateString).toLocaleString('pt-BR');
        }
        
        function showError(message) {
            console.error(message);
        }
        
        function updateLastUpdateTime() {
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('pt-BR');
        }
        
        // Auto-refresh
        function startAutoRefresh() {
            refreshInterval = setInterval(() => {
                const activeTab = document.querySelector('.tab-content.active');
                if (activeTab && activeTab.id === 'overview') {
                    loadOverviewData();
                }
            }, 30000); // 30 segundos
        }
        
        // Parar auto-refresh quando a p√°gina sair de foco
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                clearInterval(refreshInterval);
            } else {
                startAutoRefresh();
            }
        });
    </script>
</body>
</html>
