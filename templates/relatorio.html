<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório Financeiro Premium - MaestroFin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* RESET E BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #1e293b;
            background: #ffffff;
        }

        /* PALETA DE CORES MODERNA */
        :root {
            --primary-dark: #0f172a;
            --primary-blue: #1e3a8a;
            --primary-purple: #4c1d95;
            --accent-gold: #fbbf24;
            --accent-orange: #f97316;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --neutral-50: #f8fafc;
            --neutral-100: #f1f5f9;
            --neutral-200: #e2e8f0;
            --neutral-300: #cbd5e1;
            --neutral-600: #475569;
            --neutral-800: #1e293b;
            --neutral-900: #0f172a;
            --pastel-blue: #eff6ff;
            --pastel-green: #f0fdf4;
            --pastel-yellow: #fefce8;
            --pastel-purple: #faf5ff;
        }

        /* UTILITÁRIOS */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .font-medium { font-weight: 500; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-base { font-size: 1rem; line-height: 1.5rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
<!DOCTYPE html>
        /* PÁGINAS */
        .page {
            min-height: 100vh;
            padding: 40px;
            position: relative;
            page-break-after: always;
        }

        .page:last-child {
            page-break-after: avoid;
        }

        /* CAPA PREMIUM */
        .capa-page {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #4c1d95 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .capa-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 20%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);
        }

        .capa-container {
            position: relative;
            z-index: 2;
            text-align: center;
            max-width: 800px;
        }

        .logo-premium {
            font-size: 4rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .titulo-premium {
            font-size: 3.5rem;
            font-weight: 900;
            margin-bottom: 1rem;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
            letter-spacing: -0.02em;
        }

        .periodo-premium {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .avatar-container {
            position: absolute;
            top: 60px;
            right: 60px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fbbf24, #f97316);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 4px solid white;
        }

        .avatar-placeholder {
            font-size: 3rem;
            color: #0f172a;
        }

        .badge-premium {
            display: inline-block;
            background: linear-gradient(135deg, #fbbf24, #f97316);
            color: #0f172a;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-top: 2rem;
            box-shadow: 0 8px 16px rgba(251, 191, 36, 0.3);
        }

        /* DASHBOARD MODERNO */
        .dashboard-page {
            background: var(--neutral-50);
        }

        .titulo-secao {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-dark);
            margin-bottom: 3rem;
            text-align: center;
        }

        /* CARDS KPI PREMIUM */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .kpi-card {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid var(--neutral-200);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 32px 64px rgba(0,0,0,0.15);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));
        }

        .kpi-card.receita::before { background: linear-gradient(90deg, #059669, #10b981); }
        .kpi-card.despesa::before { background: linear-gradient(90deg, #dc2626, #ef4444); }
        .kpi-card.saldo::before { background: linear-gradient(90deg, #7c3aed, #8b5cf6); }
        .kpi-card.poupanca::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }

        .kpi-icon {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .kpi-card.receita .kpi-icon { background: var(--pastel-green); color: var(--success); }
        .kpi-card.despesa .kpi-icon { background: #fef2f2; color: var(--danger); }
        .kpi-card.saldo .kpi-icon { background: var(--pastel-purple); color: var(--primary-purple); }
        .kpi-card.poupanca .kpi-icon { background: var(--pastel-yellow); color: var(--warning); }

        .kpi-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--neutral-600);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .kpi-meta {
            font-size: 0.8rem;
            color: var(--neutral-600);
            font-weight: 500;
        }

        /* SCORE FINANCEIRO */
        .score-section {
            background: white;
            border-radius: 24px;
            padding: 3rem;
            margin: 4rem 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .score-circle {
            width: 160px;
            height: 160px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, #059669 0%, #10b981 25%, #f59e0b 50%, #f97316 75%, #dc2626 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .score-circle::before {
            content: '';
            position: absolute;
            inset: 8px;
            border-radius: 50%;
            background: white;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary-dark);
            position: relative;
            z-index: 1;
        }

        .score-label {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--neutral-600);
            position: relative;
            z-index: 1;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .score-item {
            text-align: center;
        }

        .score-bar-bg {
            height: 8px;
            background: var(--neutral-200);
            border-radius: 4px;
            margin: 0.5rem 0;
            overflow: hidden;
        }

        .score-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* GRÁFICOS */
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 4rem 0;
        }

        .chart-card {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-placeholder {
            height: 300px;
            background: linear-gradient(135deg, var(--neutral-100), var(--neutral-200));
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--neutral-600);
            border: 2px dashed var(--neutral-300);
        }

        .chart-placeholder i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        /* MINI CALENDÁRIO */
        .calendar-section {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            margin: 4rem 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .calendar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 2rem;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .calendar-day.positive {
            background: var(--pastel-green);
            color: var(--success);
        }

        .calendar-day.negative {
            background: #fef2f2;
            color: var(--danger);
        }

        .calendar-day.neutral {
            background: var(--neutral-100);
            color: var(--neutral-600);
        }

        /* TABELAS MODERNAS */
        .table-section {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            margin: 4rem 0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .table-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modern-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .modern-table thead th {
            background: var(--primary-dark);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border: none;
        }

        .modern-table tbody tr:nth-child(even) {
            background: var(--neutral-50);
        }

        .modern-table tbody td {
            padding: 1rem;
            border-bottom: 1px solid var(--neutral-200);
            font-size: 0.9rem;
        }

        .category-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .category-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .progress-bar {
            width: 100px;
            height: 8px;
            background: var(--neutral-200);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* INSIGHTS */
        .insights-section {
            background: linear-gradient(135deg, var(--pastel-blue), var(--pastel-purple));
            border-radius: 24px;
            padding: 3rem;
            margin: 4rem 0;
        }

        .insights-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary-dark);
            text-align: center;
            margin-bottom: 3rem;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .insight-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 16px 32px rgba(0,0,0,0.1);
            border: 1px solid var(--neutral-200);
        }

        .insight-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .insight-card.positive .insight-icon {
            background: var(--pastel-green);
            color: var(--success);
        }

        .insight-card.warning .insight-icon {
            background: var(--pastel-yellow);
            color: var(--warning);
        }

        .insight-card.info .insight-icon {
            background: var(--pastel-blue);
            color: var(--primary-blue);
        }

        .insight-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 1rem;
        }

        .insight-text {
            color: var(--neutral-600);
            line-height: 1.6;
        }

        /* RODAPÉ PREMIUM */
        .footer-section {
            background: var(--primary-dark);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            position: relative;
        }

        .footer-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));
        }

        .footer-logo {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.9;
        }

        .footer-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
        }

        .footer-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .stat-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .qr-section {
            margin-top: 3rem;
            padding: 2rem;
            background: white;
            border-radius: 16px;
            display: inline-block;
        }

        .qr-placeholder {
            width: 120px;
            height: 120px;
            background: var(--neutral-200);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
        }

        .confidential-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));
            color: var(--primary-dark);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.8rem;
            margin-top: 1rem;
        }

        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .page {
                padding: 20px;
            }

            .titulo-premium {
                font-size: 2.5rem;
            }

            .kpi-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .score-breakdown {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <!-- CAPA PREMIUM -->
    <div class="page capa-page">
        <div class="capa-container">
            <div class="logo-premium">
                <i class="fas fa-crown"></i>
            </div>
            <h1 class="titulo-premium">Relatório Financeiro</h1>
            <h2 class="periodo-premium">01 a {{ now().strftime('%d') }} de {{ mes_nome }} de {{ ano }}</h2>

            <div class="avatar-container">
                <div class="avatar-placeholder">
                    <i class="fas fa-user"></i>
                </div>
            </div>

            <div class="badge-premium">
                <i class="fas fa-star"></i>
                Exclusivo para {{ usuario.nome_completo or 'Você' }}
            </div>
        </div>
    </div>

    <!-- DASHBOARD MODERNO -->
    <div class="page dashboard-page">
        <h1 class="titulo-secao">Dashboard Financeiro</h1>

        <!-- CARDS KPI PREMIUM -->
        <div class="kpi-grid">
            <div class="kpi-card receita">
                <div class="kpi-icon">
                    <i class="fas fa-arrow-trend-up"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Receita Total</div>
                    <div class="kpi-value">R$ {{ "%.2f"|format(receita_total|float) }}</div>
                    {% if receita_total|float > 0 %}
                        {% set var_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}
                        <div class="kpi-meta">{% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs mês anterior</div>
                    {% else %}
                        <div class="kpi-meta">Sem dados anteriores</div>
                    {% endif %}
                </div>
            </div>

            <div class="kpi-card despesa">
                <div class="kpi-icon">
                    <i class="fas fa-arrow-trend-down"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Despesa Total</div>
                    <div class="kpi-value">R$ {{ "%.2f"|format(despesa_total|float) }}</div>
                    {% if despesa_total|float > 0 %}
                        {% set var_despesa = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}
                        <div class="kpi-meta">{% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs mês anterior</div>
                    {% else %}
                        <div class="kpi-meta">Sem dados anteriores</div>
                    {% endif %}
                </div>
            </div>

            <div class="kpi-card saldo">
                <div class="kpi-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Saldo Líquido</div>
                    <div class="kpi-value">R$ {{ "%.2f"|format(saldo_mes|float) }}</div>
                    <div class="kpi-meta">Resultado do mês</div>
                </div>
            </div>

            <div class="kpi-card poupanca">
                <div class="kpi-icon">
                    <i class="fas fa-piggy-bank"></i>
                </div>
                <div class="kpi-content">
                    <div class="kpi-label">Taxa de Poupança</div>
                    <div class="kpi-value">{{ "%.1f"|format(taxa_poupanca|float) }}%</div>
                    <div class="kpi-meta">Meta: 20%</div>
                </div>
            </div>
        </div>

        <!-- SCORE FINANCEIRO -->
        <div class="score-section">
            <h2 class="text-2xl font-bold mb-6">Score Financeiro do Mês</h2>
            {% set score_poupanca = (taxa_poupanca|float / 20 * 25) if taxa_poupanca|float <= 20 else 25 %}
            {% set score_saldo = 25 if saldo_mes >= 0 else (25 + (saldo_mes / despesa_total|float * 100)) if despesa_total > 0 else 0 %}
            {% set score_diversificacao = 20 %}
            {% set score_consistencia = 30 %}
            {% set score_total = score_poupanca + score_saldo + score_diversificacao + score_consistencia %}

            <div class="score-circle">
                <div class="score-number">{{ "%.0f"|format(score_total) }}</div>
                <div class="score-label">
                    {% if score_total >= 80 %}Excelente{% elif score_total >= 60 %}Bom{% elif score_total >= 40 %}Regular{% else %}Precisa Melhorar{% endif %}
                </div>
            </div>

            <div class="score-breakdown">
                <div class="score-item">
                    <div class="text-sm font-semibold text-neutral-600">Poupança</div>
                    <div class="score-bar-bg">
                        <div class="score-bar-fill" style="width: {{ (score_poupanca / 25 * 100)|round }}%; background: linear-gradient(90deg, #059669, #10b981);"></div>
                    </div>
                    <div class="text-sm font-bold">{{ "%.0f"|format(score_poupanca) }}/25</div>
                </div>
                <div class="score-item">
                    <div class="text-sm font-semibold text-neutral-600">Saldo</div>
                    <div class="score-bar-bg">
                        <div class="score-bar-fill" style="width: {{ (score_saldo / 25 * 100)|round }}%; background: linear-gradient(90deg, #7c3aed, #8b5cf6);"></div>
                    </div>
                    <div class="text-sm font-bold">{{ "%.0f"|format(score_saldo) }}/25</div>
                </div>
                <div class="score-item">
                    <div class="text-sm font-semibold text-neutral-600">Diversificação</div>
                    <div class="score-bar-bg">
                        <div class="score-bar-fill" style="width: {{ (score_diversificacao / 20 * 100)|round }}%; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>
                    </div>
                    <div class="text-sm font-bold">{{ "%.0f"|format(score_diversificacao) }}/20</div>
                </div>
                <div class="score-item">
                    <div class="text-sm font-semibold text-neutral-600">Consistência</div>
                    <div class="score-bar-bg">
                        <div class="score-bar-fill" style="width: {{ (score_consistencia / 30 * 100)|round }}%; background: linear-gradient(90deg, #dc2626, #ef4444);"></div>
                    </div>
                    <div class="text-sm font-bold">{{ "%.0f"|format(score_consistencia) }}/30</div>
                </div>
            </div>
        </div>

        <!-- GRÁFICOS -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3 class="chart-title">
                    <i class="fas fa-chart-pie"></i>
                    Distribuição de Despesas
                </h3>
                {% if grafico_pizza_base64 %}
                <img src="data:image/png;base64,{{ grafico_pizza_base64 }}" alt="Gráfico de Despesas" style="width: 100%; border-radius: 12px;">
                {% else %}
                <div class="chart-placeholder">
                    <i class="fas fa-chart-pie"></i>
                    <div class="text-lg font-semibold">Gráfico 3D de Pizza</div>
                    <div class="text-sm text-neutral-500">Dados insuficientes</div>
                </div>
                {% endif %}
            </div>

            <div class="chart-card">
                <h3 class="chart-title">
                    <i class="fas fa-chart-line"></i>
                    Evolução Mensal
                </h3>
                <div class="chart-placeholder">
                    <i class="fas fa-chart-line"></i>
                    <div class="text-lg font-semibold">Gráfico de Área</div>
                    <div class="text-sm text-neutral-500">Evolução últimos 6 meses</div>
                </div>
            </div>
        </div>

        <!-- MINI CALENDÁRIO -->
        <div class="calendar-section">
            <h3 class="calendar-title">
                <i class="fas fa-calendar-days"></i>
                Calendário Financeiro do Mês
            </h3>
            <div class="calendar-grid">
                <!-- Dias do mês (simplificado - em produção seria dinâmico) -->
                {% for day in range(1, 31) %}
                <div class="calendar-day {% if day % 3 == 0 %}positive{% elif day % 5 == 0 %}negative{% else %}neutral{% endif %}">
                    {{ day }}
                </div>
                {% endfor %}
            </div>
            <div class="text-center text-sm text-neutral-600 mt-4">
                <span class="inline-flex items-center gap-2 mr-4">
                    <div class="w-3 h-3 bg-green-100 rounded-full"></div>
                    Dias positivos
                </span>
                <span class="inline-flex items-center gap-2 mr-4">
                    <div class="w-3 h-3 bg-red-100 rounded-full"></div>
                    Dias negativos
                </span>
                <span class="inline-flex items-center gap-2">
                    <div class="w-3 h-3 bg-neutral-100 rounded-full"></div>
                    Dias neutros
                </span>
            </div>
        </div>
    </div>

    <!-- ANÁLISE DETALHADA -->
    <div class="page">
        <h1 class="titulo-secao">Análise Detalhada</h1>

        {% if gastos_agrupados %}
        <div class="table-section">
            <h3 class="table-title">
                <i class="fas fa-list-alt"></i>
                Gastos por Categoria
            </h3>
            <table class="modern-table">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Total Gasto</th>
                        <th>% do Total</th>
                        <th>Tendência</th>
                    </tr>
                </thead>
                <tbody>
                    {% for categoria, valor in gastos_agrupados %}
                    {% set cores_categorias = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1', '#fd7e14', '#20c997'] %}
                    <tr>
                        <td>
                            <div class="category-cell">
                                <div class="category-dot" style="background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>
                                {{ categoria }}
                            </div>
                        </td>
                        <td class="text-right font-semibold">R$ {{ "%.2f"|format(valor|float) }}</td>
                        <td>
                            <div class="flex items-center gap-2">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ (valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0 }}%; background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>
                                </div>
                                <span class="text-sm font-medium">{{ "%.1f"|format((valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0) }}%</span>
                            </div>
                        </td>
                        <td>
                            {% set variacao = ((valor|float / (despesa_total|float * 1.05)) - 1) * 100 if despesa_total > 0 else 0 %}
                            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium
                                {% if variacao >= 0 %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">
                                <i class="fas fa-arrow-{% if variacao >= 0 %}up{% else %}down{% endif %}"></i>
                                {% if variacao >= 0 %}+{% endif %}{{ "%.1f"|format(variacao) }}%
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- INDICADORES -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-2xl p-6 shadow-lg">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-calculator text-blue-600"></i>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-neutral-600">Gasto Médio Diário</div>
                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format((despesa_total|float / 30) if despesa_total else 0) }}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-lg">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-credit-card text-purple-600"></i>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-neutral-600">Maior Gasto</div>
                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float if gastos_agrupados else 0) }}</div>
                        <div class="text-sm text-neutral-500">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-lg">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-trophy text-yellow-600"></i>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-neutral-600">Categoria Prioritária</div>
                        <div class="text-2xl font-bold text-neutral-900">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>
                        <div class="text-sm text-neutral-500">{{ "%.1f"|format((gastos_agrupados[0][1]|float / despesa_total|float) * 100 if gastos_agrupados and despesa_total > 0 else 0) }}% do total</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- INSIGHTS & RECOMENDAÇÕES -->
    <div class="page">
        <div class="insights-section">
            <h1 class="insights-title">Descobertas Inteligentes</h1>

            <div class="insights-grid">
                <!-- Insight sobre padrão de gastos -->
                <div class="insight-card positive">
                    <div class="insight-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h4 class="insight-title">Padrão de Gastos Identificado</h4>
                    {% if gastos_agrupados %}
                    {% set categoria_principal = gastos_agrupados[0][0] %}
                    {% set percentual_principal = (gastos_agrupados[0][1]|float / despesa_total|float * 100) if despesa_total > 0 else 0 %}
                    <p class="insight-text">
                        <strong>{{ "%.1f"|format(percentual_principal) }}%</strong> dos seus gastos se concentram em <strong>{{ categoria_principal }}</strong>.
                        {% if percentual_principal > 40 %}
                        Que tal reduzir 15% nessa categoria e economizar R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float * 0.15) }} mensais?
                        {% elif percentual_principal > 25 %}
                        Ótimo equilíbrio! Continue diversificando seus gastos.
                        {% else %}
                        Excelente distribuição - você está no caminho certo!
                        {% endif %}
                    </p>
                    {% else %}
                    <p class="insight-text">Continue registrando seus gastos para descobertas personalizadas!</p>
                    {% endif %}
                </div>

                <!-- Insight sobre economia -->
                <div class="insight-card warning">
                    <div class="insight-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <h4 class="insight-title">Oportunidade de Economia</h4>
                    {% if gastos_agrupados and gastos_agrupados|length >= 2 %}
                    {% set segunda_categoria = gastos_agrupados[1][0] %}
                    {% set valor_economia = gastos_agrupados[1][1]|float * 0.15 %}
                    <p class="insight-text">
                        Reduzindo apenas <strong>15%</strong> dos gastos em <strong>{{ segunda_categoria }}</strong>,
                        você economizaria <strong>R$ {{ "%.2f"|format(valor_economia) }}</strong> este mês.
                        Em um ano, isso vira <strong>R$ {{ "%.2f"|format(valor_economia * 12) }}</strong>!
                    </p>
                    {% else %}
                    <p class="insight-text">Mais dados = mais oportunidades de economia personalizadas.</p>
                    {% endif %}
                </div>

                <!-- Insight sobre performance -->
                <div class="insight-card info">
                    <div class="insight-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h4 class="insight-title">Sua Performance</h4>
                    {% if taxa_poupanca|float >= 20 %}
                    <p class="insight-text">
                        <strong>Parabéns!</strong> Sua taxa de poupança de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong>
                        está acima da meta. Você está construindo riqueza de verdade!
                    </p>
                    {% elif taxa_poupanca|float >= 10 %}
                    <p class="insight-text">
                        Taxa de poupança intermediária. Com pequenos ajustes, você chega aos 20% facilmente.
                    </p>
                    {% else %}
                    <p class="insight-text">
                        Todo começo é válido. Cada real poupado é uma vitória rumo à independência financeira.
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- RODAPÉ PREMIUM -->
    <div class="page footer-section">
        <div class="footer-logo">
            <i class="fas fa-crown"></i>
        </div>
        <h2 class="footer-title">Maestro Financeiro Premium</h2>

        <div class="footer-stats">
            <div class="stat-item">
                <i class="fas fa-calendar"></i>
                <span>Período: {{ mes_nome }} {{ ano }}</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span>Gerado: {{ now().strftime('%d/%m/%Y %H:%M') }}</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-file-pdf"></i>
                <span>Relatório Premium v3.0</span>
            </div>
        </div>

        <div class="qr-section">
            <div class="qr-placeholder">
                <i class="fas fa-qrcode text-4xl text-neutral-400"></i>
            </div>
            <div class="text-sm font-semibold text-neutral-700 mb-2">Acesse seu bot</div>
            <div class="text-xs text-neutral-500">Toque para conversar com o Maestro</div>
        </div>

        <div class="confidential-badge">
            <i class="fas fa-shield-alt"></i>
            Relatório Confidencial - Exclusivo
        </div>
    </div>
</body>

</html>
    <link rel="preconnect" href="https://fonts.googleapis.com">    <meta charset="UTF-8">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>    <title>Relatório Financeiro Premium - MaestroFin</title>

        /* RESET E BASE */

        * {    <link rel="preconnect" href="https://fonts.googleapis.com"><head><head>

            margin: 0;

            padding: 0;    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

            box-sizing: border-box;

        }    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">    <meta charset="UTF-8">    <meta charset="UTF-8">



        body {    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            line-height: 1.6;    <style>    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <meta name="viewport" content="width=device-width, initial-scale=1.0">

            color: #1e293b;

            background: #ffffff;        /* RESET E BASE */

        }

        * {    <title>Relatório Financeiro Premium - MaestroFin</title>    <title>Relatório Financeiro Detalhado</title>

        /* PALETA DE CORES MODERNA */

        :root {            margin: 0;

            --primary-dark: #0f172a;

            --primary-blue: #1e3a8a;            padding: 0;    <link rel="preconnect" href="https://fonts.googleapis.com">    <link rel="stylesheet" href="relatorio.css">

            --primary-purple: #4c1d95;

            --accent-gold: #fbbf24;            box-sizing: border-box;

            --accent-orange: #f97316;

            --success: #059669;        }    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

            --warning: #d97706;

            --danger: #dc2626;

            --neutral-50: #f8fafc;

            --neutral-100: #f1f5f9;        body {    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"></head>

            --neutral-200: #e2e8f0;

            --neutral-300: #cbd5e1;            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

            --neutral-600: #475569;

            --neutral-800: #1e293b;            line-height: 1.6;    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

            --neutral-900: #0f172a;

            --pastel-blue: #eff6ff;            color: #1e293b;

            --pastel-green: #f0fdf4;

            --pastel-yellow: #fefce8;            background: #ffffff;    <style><body>

            --pastel-purple: #faf5ff;

        }        }



        /* UTILITÁRIOS */        /* RESET E BASE */    <!-- CAPA -->

        .text-center { text-align: center; }

        .text-right { text-align: right; }        /* PALETA DE CORES MODERNA */

        .font-bold { font-weight: 700; }

        .font-semibold { font-weight: 600; }        :root {        * {    <div class="page capa-page">

        .font-medium { font-weight: 500; }

        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }            --primary-dark: #0f172a;

        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }

        .text-2xl { font-size: 1.5rem; line-height: 2rem; }            --primary-blue: #1e3a8a;            margin: 0;        <div class="capa-container">

        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }

        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }            --primary-purple: #4c1d95;

        .text-base { font-size: 1rem; line-height: 1.5rem; }

        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }            --accent-gold: #fbbf24;            padding: 0;            <div class="logo-container">



        /* PÁGINAS */            --accent-orange: #f97316;

        .page {

            min-height: 100vh;            --success: #059669;            box-sizing: border-box;                <i class="fas fa-chart-line logo-icon"></i>

            padding: 40px;

            position: relative;            --warning: #d97706;

            page-break-after: always;

        }            --danger: #dc2626;        }            </div>



        .page:last-child {            --neutral-50: #f8fafc;

            page-break-after: avoid;

        }            --neutral-100: #f1f5f9;            <h1 class="titulo-principal">Relatório Financeiro Detalhado</h1>



        /* CAPA PREMIUM */            --neutral-200: #e2e8f0;

        .capa-page {

            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #4c1d95 100%);            --neutral-300: #cbd5e1;        body {            <h2 class="subtitulo">{{ mes_nome }} de {{ ano }}</h2>

            color: white;

            display: flex;            --neutral-600: #475569;

            align-items: center;

            justify-content: center;            --neutral-800: #1e293b;            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;            <p class="nome-usuario">Preparado especialmente para <strong>{{ usuario.nome_completo or 'Você' }}</strong>

            position: relative;

            overflow: hidden;            --neutral-900: #0f172a;

        }

            --pastel-blue: #eff6ff;            line-height: 1.6;            </p>

        .capa-page::before {

            content: '';            --pastel-green: #f0fdf4;

            position: absolute;

            top: 0;            --pastel-yellow: #fefce8;            color: #1e293b;

            left: 0;

            right: 0;            --pastel-purple: #faf5ff;

            bottom: 0;

            background: radial-gradient(circle at 30% 20%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),        }            background: #ffffff;            <div class="data-geracao">

                        radial-gradient(circle at 70% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);

        }



        .capa-container {        /* UTILITÁRIOS */        }                <i class="fas fa-calendar-alt"></i>

            position: relative;

            z-index: 2;        .text-center { text-align: center; }

            text-align: center;

            max-width: 800px;        .text-right { text-align: right; }                Gerado em {{ now().strftime('%d/%m/%Y às %H:%M') }}

        }

        .font-bold { font-weight: 700; }

        .logo-premium {

            font-size: 4rem;        .font-semibold { font-weight: 600; }        /* PALETA DE CORES MODERNA */            </div>

            margin-bottom: 2rem;

            opacity: 0.9;        .font-medium { font-weight: 500; }

        }

        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }        :root {

        .titulo-premium {

            font-size: 3.5rem;        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }

            font-weight: 900;

            margin-bottom: 1rem;        .text-2xl { font-size: 1.5rem; line-height: 2rem; }            --primary-dark: #0f172a;            <div class="highlight-box {% if saldo_mes >= 0 %}positivo{% else %}negativo{% endif %}">

            text-shadow: 0 4px 8px rgba(0,0,0,0.3);

            letter-spacing: -0.02em;        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }

        }

        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }            --primary-blue: #1e3a8a;                {% if saldo_mes >= 0 %}

        .periodo-premium {

            font-size: 1.5rem;        .text-base { font-size: 1rem; line-height: 1.5rem; }

            font-weight: 600;

            margin-bottom: 2rem;        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }            --primary-purple: #4c1d95;                <h3><i class="fas fa-check-circle"></i> Saldo Positivo!</h3>

            opacity: 0.9;

        }



        .avatar-container {        /* PÁGINAS */            --accent-gold: #fbbf24;                <p>Você economizou <strong>R$ {{ "%.2f"|format(saldo_mes|float) }}</strong> este mês. Parabéns!</p>

            position: absolute;

            top: 60px;        .page {

            right: 60px;

            width: 120px;            min-height: 100vh;            --accent-orange: #f97316;                {% else %}

            height: 120px;

            border-radius: 50%;            padding: 40px;

            background: linear-gradient(135deg, #fbbf24, #f97316);

            display: flex;            position: relative;            --success: #059669;                <h3><i class="fas fa-exclamation-triangle"></i> Atenção ao Orçamento!</h3>

            align-items: center;

            justify-content: center;            page-break-after: always;

            box-shadow: 0 20px 40px rgba(0,0,0,0.3);

            border: 4px solid white;        }            --warning: #d97706;                <p>Seu saldo ficou negativo em <strong>R$ {{ "%.2f"|format(saldo_mes|abs|float) }}</strong> este mês.

        }



        .avatar-placeholder {

            font-size: 3rem;        .page:last-child {            --danger: #dc2626;                </p>

            color: #0f172a;

        }            page-break-after: avoid;



        .badge-premium {        }            --neutral-50: #f8fafc;                {% endif %}

            display: inline-block;

            background: linear-gradient(135deg, #fbbf24, #f97316);

            color: #0f172a;

            padding: 12px 24px;        /* CAPA PREMIUM */            --neutral-100: #f1f5f9;            </div>

            border-radius: 50px;

            font-weight: 700;        .capa-page {

            font-size: 0.9rem;

            margin-top: 2rem;            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #4c1d95 100%);            --neutral-200: #e2e8f0;

            box-shadow: 0 8px 16px rgba(251, 191, 36, 0.3);

        }            color: white;



        /* DASHBOARD MODERNO */            display: flex;            --neutral-300: #cbd5e1;            <div class="resumo-executivo">

        .dashboard-page {

            background: var(--neutral-50);            align-items: center;

        }

            justify-content: center;            --neutral-600: #475569;                <h3><i class="fas fa-chart-bar"></i> Resumo Executivo</h3>

        .titulo-secao {

            font-size: 2.5rem;            position: relative;

            font-weight: 800;

            color: var(--primary-dark);            overflow: hidden;            --neutral-800: #1e293b;                <div class="resumo-grid">

            margin-bottom: 3rem;

            text-align: center;        }

        }

            --neutral-900: #0f172a;                    <div class="resumo-item">

        /* CARDS KPI PREMIUM */

        .kpi-grid {        .capa-page::before {

            display: grid;

            grid-template-columns: repeat(2, 1fr);            content: '';            --pastel-blue: #eff6ff;                        <span class="resumo-label">Receitas:</span>

            gap: 2rem;

            margin-bottom: 4rem;            position: absolute;

        }

            top: 0;            --pastel-green: #f0fdf4;                        <span class="resumo-valor positivo">R$ {{ "%.2f"|format(receita_total|float) }}</span>

        .kpi-card {

            background: white;            left: 0;

            border-radius: 24px;

            padding: 2rem;            right: 0;            --pastel-yellow: #fefce8;                    </div>

            box-shadow: 0 20px 40px rgba(0,0,0,0.1);

            border: 1px solid var(--neutral-200);            bottom: 0;

            position: relative;

            overflow: hidden;            background: radial-gradient(circle at 30% 20%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),            --pastel-purple: #faf5ff;                    <div class="resumo-item">

            transition: transform 0.3s ease, box-shadow 0.3s ease;

        }                        radial-gradient(circle at 70% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);



        .kpi-card:hover {        }        }                        <span class="resumo-label">Despesas:</span>

            transform: translateY(-4px);

            box-shadow: 0 32px 64px rgba(0,0,0,0.15);

        }

        .capa-container {                        <span class="resumo-valor negativo">R$ {{ "%.2f"|format(despesa_total|float) }}</span>

        .kpi-card::before {

            content: '';            position: relative;

            position: absolute;

            top: 0;            z-index: 2;        /* UTILITÁRIOS */                    </div>

            left: 0;

            right: 0;            text-align: center;

            height: 4px;

            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));            max-width: 800px;        .text-center { text-align: center; }                    <div class="resumo-item">

        }

        }

        .kpi-card.receita::before { background: linear-gradient(90deg, #059669, #10b981); }

        .kpi-card.despesa::before { background: linear-gradient(90deg, #dc2626, #ef4444); }        .text-right { text-align: right; }                        <span class="resumo-label">Taxa de Poupança:</span>

        .kpi-card.saldo::before { background: linear-gradient(90deg, #7c3aed, #8b5cf6); }

        .kpi-card.poupanca::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }        .logo-premium {



        .kpi-icon {            font-size: 4rem;        .font-bold { font-weight: 700; }                        <span class="resumo-valor neutro">{{ "%.1f"|format(taxa_poupanca|float) }}%</span>

            position: absolute;

            top: 1.5rem;            margin-bottom: 2rem;

            right: 1.5rem;

            width: 48px;            opacity: 0.9;        .font-semibold { font-weight: 600; }                    </div>

            height: 48px;

            border-radius: 50%;        }

            display: flex;

            align-items: center;        .font-medium { font-weight: 500; }                </div>

            justify-content: center;

            font-size: 1.25rem;        .titulo-premium {

        }

            font-size: 3.5rem;        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }            </div>

        .kpi-card.receita .kpi-icon { background: var(--pastel-green); color: var(--success); }

        .kpi-card.despesa .kpi-icon { background: #fef2f2; color: var(--danger); }            font-weight: 900;

        .kpi-card.saldo .kpi-icon { background: var(--pastel-purple); color: var(--primary-purple); }

        .kpi-card.poupanca .kpi-icon { background: var(--pastel-yellow); color: var(--warning); }            margin-bottom: 1rem;        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }        </div>



        .kpi-label {            text-shadow: 0 4px 8px rgba(0,0,0,0.3);

            font-size: 0.9rem;

            font-weight: 600;            letter-spacing: -0.02em;        .text-2xl { font-size: 1.5rem; line-height: 2rem; }    </div>

            color: var(--neutral-600);

            margin-bottom: 0.5rem;        }

            text-transform: uppercase;

            letter-spacing: 0.05em;        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }

        }

        .periodo-premium {

        .kpi-value {

            font-size: 2.5rem;            font-size: 1.5rem;        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }    <!-- DASHBOARD PRINCIPAL -->

            font-weight: 800;

            color: var(--primary-dark);            font-weight: 600;

            margin-bottom: 0.5rem;

        }            margin-bottom: 2rem;        .text-base { font-size: 1rem; line-height: 1.5rem; }    <div class="page dashboard-page">



        .kpi-meta {            opacity: 0.9;

            font-size: 0.8rem;

            color: var(--neutral-600);        }        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }        <h1 class="titulo-pagina"><i class="fas fa-tachometer-alt"></i> Dashboard Financeiro</h1>

            font-weight: 500;

        }



        /* SCORE FINANCEIRO */        .avatar-container {

        .score-section {

            background: white;            position: absolute;

            border-radius: 24px;

            padding: 3rem;            top: 60px;        /* PÁGINAS */        <div class="kpi-container">

            margin: 4rem 0;

            box-shadow: 0 20px 40px rgba(0,0,0,0.1);            right: 60px;

            text-align: center;

        }            width: 120px;        .page {            <div class="kpi-box receita">



        .score-circle {            height: 120px;

            width: 160px;

            height: 160px;            border-radius: 50%;            min-height: 100vh;                <div class="kpi-icon"><i class="fas fa-arrow-up"></i></div>

            border-radius: 50%;

            background: conic-gradient(from 0deg, #059669 0%, #10b981 25%, #f59e0b 50%, #f97316 75%, #dc2626 100%);            background: linear-gradient(135deg, #fbbf24, #f97316);

            display: flex;

            flex-direction: column;            display: flex;            padding: 40px;                <div class="kpi-content">

            align-items: center;

            justify-content: center;            align-items: center;

            margin: 0 auto 2rem;

            position: relative;            justify-content: center;            position: relative;                    <h4>Receita Total</h4>

            box-shadow: 0 20px 40px rgba(0,0,0,0.2);

        }            box-shadow: 0 20px 40px rgba(0,0,0,0.3);



        .score-circle::before {            border: 4px solid white;            page-break-after: always;                    <p class="valor verde">R$ {{ "%.2f"|format(receita_total|float) }}</p>

            content: '';

            position: absolute;        }

            inset: 8px;

            border-radius: 50%;        }                    {% if receita_total|float > 0 %}

            background: white;

        }        .avatar-placeholder {



        .score-number {            font-size: 3rem;                        {% set var_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}

            font-size: 3rem;

            font-weight: 900;            color: #0f172a;

            color: var(--primary-dark);

            position: relative;        }        .page:last-child {                        <small class="kpi-meta">{% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs mês anterior</small>

            z-index: 1;

        }



        .score-label {        .badge-premium {            page-break-after: avoid;                    {% else %}

            font-size: 1.1rem;

            font-weight: 700;            display: inline-block;

            color: var(--neutral-600);

            position: relative;            background: linear-gradient(135deg, #fbbf24, #f97316);        }                        <small class="kpi-meta">Sem dados do mês anterior</small>

            z-index: 1;

        }            color: #0f172a;



        .score-breakdown {            padding: 12px 24px;                    {% endif %}

            display: grid;

            grid-template-columns: repeat(4, 1fr);            border-radius: 50px;

            gap: 1.5rem;

            margin-top: 2rem;            font-weight: 700;        /* CAPA PREMIUM */                </div>

        }

            font-size: 0.9rem;

        .score-item {

            text-align: center;            margin-top: 2rem;        .capa-page {            </div>

        }

            box-shadow: 0 8px 16px rgba(251, 191, 36, 0.3);

        .score-bar-bg {

            height: 8px;        }            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 50%, #4c1d95 100%);            <div class="kpi-box despesa">

            background: var(--neutral-200);

            border-radius: 4px;

            margin: 0.5rem 0;

            overflow: hidden;        /* DASHBOARD MODERNO */            color: white;                <div class="kpi-icon"><i class="fas fa-arrow-down"></i></div>

        }

        .dashboard-page {

        .score-bar-fill {

            height: 100%;            background: var(--neutral-50);            display: flex;                <div class="kpi-content">

            border-radius: 4px;

            transition: width 0.3s ease;        }

        }

            align-items: center;                    <h4>Despesa Total</h4>

        /* GRÁFICOS */

        .charts-grid {        .titulo-secao {

            display: grid;

            grid-template-columns: 1fr 1fr;            font-size: 2.5rem;            justify-content: center;                    <p class="valor vermelho">R$ {{ "%.2f"|format(despesa_total|float) }}</p>

            gap: 2rem;

            margin: 4rem 0;            font-weight: 800;

        }

            color: var(--primary-dark);            position: relative;                    {% if despesa_total|float > 0 %}

        .chart-card {

            background: white;            margin-bottom: 3rem;

            border-radius: 24px;

            padding: 2rem;            text-align: center;            overflow: hidden;                        {% set var_despesa = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}

            box-shadow: 0 20px 40px rgba(0,0,0,0.1);

        }        }



        .chart-title {        }                        <small class="kpi-meta">{% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs mês anterior</small>

            font-size: 1.5rem;

            font-weight: 700;        /* CARDS KPI PREMIUM */

            color: var(--primary-dark);

            margin-bottom: 1.5rem;        .kpi-grid {                    {% else %}

            display: flex;

            align-items: center;            display: grid;

            gap: 0.5rem;

        }            grid-template-columns: repeat(2, 1fr);        .capa-page::before {                        <small class="kpi-meta">Sem dados do mês anterior</small>



        .chart-placeholder {            gap: 2rem;

            height: 300px;

            background: linear-gradient(135deg, var(--neutral-100), var(--neutral-200));            margin-bottom: 4rem;            content: '';                    {% endif %}

            border-radius: 16px;

            display: flex;        }

            flex-direction: column;

            align-items: center;            position: absolute;                </div>

            justify-content: center;

            color: var(--neutral-600);        .kpi-card {

            border: 2px dashed var(--neutral-300);

        }            background: white;            top: 0;            </div>



        .chart-placeholder i {            border-radius: 24px;

            font-size: 3rem;

            margin-bottom: 1rem;            padding: 2rem;            left: 0;            <div class="kpi-box saldo">

            opacity: 0.6;

        }            box-shadow: 0 20px 40px rgba(0,0,0,0.1);



        /* MINI CALENDÁRIO */            border: 1px solid var(--neutral-200);            right: 0;                <div class="kpi-icon"><i class="fas fa-wallet"></i></div>

        .calendar-section {

            background: white;            position: relative;

            border-radius: 24px;

            padding: 2rem;            overflow: hidden;            bottom: 0;                <div class="kpi-content">

            margin: 4rem 0;

            box-shadow: 0 20px 40px rgba(0,0,0,0.1);            transition: transform 0.3s ease, box-shadow 0.3s ease;

        }

        }            background: radial-gradient(circle at 30% 20%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),                    <h4>Saldo Líquido</h4>

        .calendar-title {

            font-size: 1.5rem;

            font-weight: 700;

            color: var(--primary-dark);        .kpi-card:hover {                        radial-gradient(circle at 70% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);                    <p class="valor {% if saldo_mes >= 0 %}verde{% else %}vermelho{% endif %}">R$ {{

            margin-bottom: 2rem;

            text-align: center;            transform: translateY(-4px);

        }

            box-shadow: 0 32px 64px rgba(0,0,0,0.15);        }                        "%.2f"|format(saldo_mes|float) }}</p>

        .calendar-grid {

            display: grid;        }

            grid-template-columns: repeat(7, 1fr);

            gap: 0.5rem;                    <small class="kpi-meta">Resultado do mês</small>

            margin-bottom: 1rem;

        }        .kpi-card::before {



        .calendar-day {            content: '';        .capa-container {                </div>

            aspect-ratio: 1;

            border-radius: 8px;            position: absolute;

            display: flex;

            align-items: center;            top: 0;            position: relative;            </div>

            justify-content: center;

            font-size: 0.8rem;            left: 0;

            font-weight: 600;

            transition: all 0.2s ease;            right: 0;            z-index: 2;            <div class="kpi-box poupanca">

        }

            height: 4px;

        .calendar-day.positive {

            background: var(--pastel-green);            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));            text-align: center;                <div class="kpi-icon"><i class="fas fa-piggy-bank"></i></div>

            color: var(--success);

        }        }



        .calendar-day.negative {            max-width: 800px;                <div class="kpi-content">

            background: #fef2f2;

            color: var(--danger);        .kpi-card.receita::before { background: linear-gradient(90deg, #059669, #10b981); }

        }

        .kpi-card.despesa::before { background: linear-gradient(90deg, #dc2626, #ef4444); }        }                    <h4>Taxa de Poupança</h4>

        .calendar-day.neutral {

            background: var(--neutral-100);        .kpi-card.saldo::before { background: linear-gradient(90deg, #7c3aed, #8b5cf6); }

            color: var(--neutral-600);

        }        .kpi-card.poupanca::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }                    <p class="valor azul">{{ "%.1f"|format(taxa_poupanca|float) }}%</p>



        /* TABELAS MODERNAS */

        .table-section {

            background: white;        .kpi-icon {        .logo-premium {                    <small class="kpi-meta">Meta: 20%</small>

            border-radius: 24px;

            padding: 2rem;            position: absolute;

            margin: 4rem 0;

            box-shadow: 0 20px 40px rgba(0,0,0,0.1);            top: 1.5rem;            font-size: 4rem;                </div>

            overflow: hidden;

        }            right: 1.5rem;



        .table-title {            width: 48px;            margin-bottom: 2rem;            </div>

            font-size: 1.5rem;

            font-weight: 700;            height: 48px;

            color: var(--primary-dark);

            margin-bottom: 2rem;            border-radius: 50%;            opacity: 0.9;        </div>

            display: flex;

            align-items: center;            display: flex;

            gap: 0.5rem;

        }            align-items: center;        }



        .modern-table {            justify-content: center;

            width: 100%;

            border-collapse: separate;            font-size: 1.25rem;        <!-- SCORE FINANCEIRO -->

            border-spacing: 0;

        }        }



        .modern-table thead th {        .titulo-premium {        <div class="score-container">

            background: var(--primary-dark);

            color: white;        .kpi-card.receita .kpi-icon { background: var(--pastel-green); color: var(--success); }

            padding: 1rem;

            text-align: left;        .kpi-card.despesa .kpi-icon { background: #fef2f2; color: var(--danger); }            font-size: 3.5rem;            <h3><i class="fas fa-star"></i> Score Financeiro do Mês</h3>

            font-weight: 600;

            font-size: 0.9rem;        .kpi-card.saldo .kpi-icon { background: var(--pastel-purple); color: var(--primary-purple); }

            text-transform: uppercase;

            letter-spacing: 0.05em;        .kpi-card.poupanca .kpi-icon { background: var(--pastel-yellow); color: var(--warning); }            font-weight: 900;            {% set score_poupanca = (taxa_poupanca|float / 20 * 25) if taxa_poupanca|float <= 20 else 25 %} {% set

            border: none;

        }



        .modern-table tbody tr:nth-child(even) {        .kpi-label {            margin-bottom: 1rem;                {% set score_saldo = 25 if saldo_mes >= 0 else (25 + (saldo_mes / despesa_total|float * 100)) if despesa_total > 0 else 0 %}

            background: var(--neutral-50);

        }            font-size: 0.9rem;



        .modern-table tbody td {            font-weight: 600;            text-shadow: 0 4px 8px rgba(0,0,0,0.3);                else 0 %}

            padding: 1rem;

            border-bottom: 1px solid var(--neutral-200);            color: var(--neutral-600);

            font-size: 0.9rem;

        }            margin-bottom: 0.5rem;            letter-spacing: -0.02em;                {% set score_diversificacao = 20 %}



        .category-cell {            text-transform: uppercase;

            display: flex;

            align-items: center;            letter-spacing: 0.05em;        }                {% set score_consistencia = 30 %}

            gap: 0.75rem;

        }        }



        .category-dot {                {% set score_total = score_poupanca + score_saldo + score_diversificacao + score_consistencia %}

            width: 12px;

            height: 12px;        .kpi-value {

            border-radius: 50%;

        }            font-size: 2.5rem;        .periodo-premium {



        .progress-bar {            font-weight: 800;

            width: 100px;

            height: 8px;            color: var(--primary-dark);            font-size: 1.5rem;                <div class="score-display">

            background: var(--neutral-200);

            border-radius: 4px;            margin-bottom: 0.5rem;

            overflow: hidden;

        }        }            font-weight: 600;                    <div



        .progress-fill {

            height: 100%;

            border-radius: 4px;        .kpi-meta {            margin-bottom: 2rem;                        class="score-circle {% if score_total >= 80 %}excelente{% elif score_total >= 60 %}bom{% elif score_total >= 40 %}regular{% else %}precisa-melhorar{% endif %}">

            transition: width 0.3s ease;

        }            font-size: 0.8rem;



        /* INSIGHTS */            color: var(--neutral-600);            opacity: 0.9;                        <div class="score-number">{{ "%.0f"|format(score_total) }}</div>

        .insights-section {

            background: linear-gradient(135deg, var(--pastel-blue), var(--pastel-purple));            font-weight: 500;

            border-radius: 24px;

            padding: 3rem;        }        }                        <div class="score-label">

            margin: 4rem 0;

        }



        .insights-title {        /* SCORE FINANCEIRO */                            {% if score_total >= 80 %}Excelente{% elif score_total >= 60 %}Bom{% elif score_total >= 40

            font-size: 2rem;

            font-weight: 800;        .score-section {

            color: var(--primary-dark);

            text-align: center;            background: white;        .avatar-container {                            %}Regular{% else %}Precisa Melhorar{% endif %}

            margin-bottom: 3rem;

        }            border-radius: 24px;



        .insights-grid {            padding: 3rem;            position: absolute;                        </div>

            display: grid;

            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));            margin: 4rem 0;

            gap: 2rem;

        }            box-shadow: 0 20px 40px rgba(0,0,0,0.1);            top: 60px;                    </div>



        .insight-card {            text-align: center;

            background: white;

            border-radius: 20px;        }            right: 60px;

            padding: 2rem;

            box-shadow: 0 16px 32px rgba(0,0,0,0.1);

            border: 1px solid var(--neutral-200);

        }        .score-circle {            width: 120px;                    <div class="score-detalhes">



        .insight-icon {            width: 160px;

            width: 56px;

            height: 56px;            height: 160px;            height: 120px;                        <div class="score-item">

            border-radius: 50%;

            display: flex;            border-radius: 50%;

            align-items: center;

            justify-content: center;            background: conic-gradient(from 0deg, #059669 0%, #10b981 25%, #f59e0b 50%, #f97316 75%, #dc2626 100%);            border-radius: 50%;                            <span class="score-categoria">Poupança</span>

            font-size: 1.5rem;

            margin-bottom: 1.5rem;            display: flex;

        }

            flex-direction: column;            background: linear-gradient(135deg, #fbbf24, #f97316);                            <div class="score-bar">

        .insight-card.positive .insight-icon {

            background: var(--pastel-green);            align-items: center;

            color: var(--success);

        }            justify-content: center;            display: flex;                                <div class="score-fill" style="width: {{ (score_poupanca / 25 * 100) }}%"></div>



        .insight-card.warning .insight-icon {            margin: 0 auto 2rem;

            background: var(--pastel-yellow);

            color: var(--warning);            position: relative;            align-items: center;                            </div>

        }

            box-shadow: 0 20px 40px rgba(0,0,0,0.2);

        .insight-card.info .insight-icon {

            background: var(--pastel-blue);        }            justify-content: center;                            <span class="score-pontos">{{ "%.0f"|format(score_poupanca) }}/25</span>

            color: var(--primary-blue);

        }



        .insight-title {        .score-circle::before {            box-shadow: 0 20px 40px rgba(0,0,0,0.3);                        </div>

            font-size: 1.25rem;

            font-weight: 700;            content: '';

            color: var(--primary-dark);

            margin-bottom: 1rem;            position: absolute;            border: 4px solid white;                        <div class="score-item">

        }

            inset: 8px;

        .insight-text {

            color: var(--neutral-600);            border-radius: 50%;        }                            <span class="score-categoria">Saldo Positivo</span>

            line-height: 1.6;

        }            background: white;



        /* RODAPÉ PREMIUM */        }                            <div class="score-bar">

        .footer-section {

            background: var(--primary-dark);

            color: white;

            padding: 4rem 2rem;        .score-number {        .avatar-placeholder {                                <div class="score-fill" style="width: {{ (score_saldo / 25 * 100) }}%"></div>

            text-align: center;

            position: relative;            font-size: 3rem;

        }

            font-weight: 900;            font-size: 3rem;                            </div>

        .footer-section::before {

            content: '';            color: var(--primary-dark);

            position: absolute;

            top: 0;            position: relative;            color: #0f172a;                            <span class="score-pontos">{{ "%.0f"|format(score_saldo) }}/25</span>

            left: 0;

            right: 0;            z-index: 1;

            height: 4px;

            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));        }        }                        </div>

        }



        .footer-logo {

            font-size: 2.5rem;        .score-label {                        <div class="score-item">

            margin-bottom: 1rem;

            opacity: 0.9;            font-size: 1.1rem;

        }

            font-weight: 700;        .badge-premium {                            <span class="score-categoria">Diversificação</span>

        .footer-title {

            font-size: 1.5rem;            color: var(--neutral-600);

            font-weight: 700;

            margin-bottom: 2rem;            position: relative;            display: inline-block;                            <div class="score-bar">

        }

            z-index: 1;

        .footer-stats {

            display: grid;        }            background: linear-gradient(135deg, #fbbf24, #f97316);                                <div class="score-fill" style="width: {{ (score_diversificacao / 20 * 100) }}%"></div>

            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));

            gap: 2rem;

            margin: 3rem 0;

        }        .score-breakdown {            color: #0f172a;                            </div>



        .stat-item {            display: grid;

            display: inline-flex;

            align-items: center;            grid-template-columns: repeat(4, 1fr);            padding: 12px 24px;                            <span class="score-pontos">{{ "%.0f"|format(score_diversificacao) }}/20</span>

            justify-content: center;

            gap: 0.75rem;            gap: 1.5rem;

            padding: 1rem;

            background: rgba(255,255,255,0.1);            margin-top: 2rem;            border-radius: 50px;                        </div>

            border-radius: 12px;

            backdrop-filter: blur(10px);        }

        }

            font-weight: 700;                        <div class="score-item">

        .qr-section {

            margin-top: 3rem;        .score-item {

            padding: 2rem;

            background: white;            text-align: center;            font-size: 0.9rem;                            <span class="score-categoria">Consistência</span>

            border-radius: 16px;

            display: inline-block;        }

        }

            margin-top: 2rem;                            <div class="score-bar">

        .qr-placeholder {

            width: 120px;        .score-bar-bg {

            height: 120px;

            background: var(--neutral-200);            height: 8px;            box-shadow: 0 8px 16px rgba(251, 191, 36, 0.3);                                <div class="score-fill" style="width: {{ (score_consistencia / 30 * 100) }}%"></div>

            border-radius: 8px;

            display: flex;            background: var(--neutral-200);

            align-items: center;

            justify-content: center;            border-radius: 4px;        }                            </div>

            margin: 0 auto 1rem;

        }            margin: 0.5rem 0;



        .confidential-badge {            overflow: hidden;                            <span class="score-pontos">{{ "%.0f"|format(score_consistencia) }}/30</span>

            display: inline-block;

            background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));        }

            color: var(--primary-dark);

            padding: 8px 16px;        /* DASHBOARD MODERNO */                        </div>

            border-radius: 20px;

            font-weight: 700;        .score-bar-fill {

            font-size: 0.8rem;

            margin-top: 1rem;            height: 100%;        .dashboard-page {                    </div>

        }

            border-radius: 4px;

        /* RESPONSIVIDADE */

        @media (max-width: 768px) {            transition: width 0.3s ease;            background: var(--neutral-50);                </div>

            .page {

                padding: 20px;        }

            }

        }        </div>

            .titulo-premium {

                font-size: 2.5rem;        /* GRÁFICOS */

            }

        .charts-grid {

            .kpi-grid {

                grid-template-columns: 1fr;            display: grid;

            }

            grid-template-columns: 1fr 1fr;        .titulo-secao {        <div class="graficos-row">

            .charts-grid {

                grid-template-columns: 1fr;            gap: 2rem;

            }

            margin: 4rem 0;            font-size: 2.5rem;            <div class="grafico-container">

            .score-breakdown {

                grid-template-columns: repeat(2, 1fr);        }

            }

        }            font-weight: 800;                <h3><i class="fas fa-chart-pie"></i> Distribuição de Despesas</h3>

    </style>

</head>        .chart-card {



<body>            background: white;            color: var(--primary-dark);                {% if grafico_pizza_base64 %}

    <!-- CAPA PREMIUM -->

    <div class="page capa-page">            border-radius: 24px;

        <div class="capa-container">

            <div class="logo-premium">            padding: 2rem;            margin-bottom: 3rem;                <img src="data:image/png;base64,{{ grafico_pizza_base64 }}" alt="Gráfico de Despesas" loading="lazy">

                <i class="fas fa-crown"></i>

            </div>            box-shadow: 0 20px 40px rgba(0,0,0,0.1);

            <h1 class="titulo-premium">Relatório Financeiro</h1>

            <h2 class="periodo-premium">01 a {{ now().strftime('%d') }} de {{ mes_nome }} de {{ ano }}</h2>        }            text-align: center;                {% else %}



            <div class="avatar-container">

                <div class="avatar-placeholder">

                    <i class="fas fa-user"></i>        .chart-title {        }                <div class="grafico-placeholder">

                </div>

            </div>            font-size: 1.5rem;



            <div class="badge-premium">            font-weight: 700;                    <i class="fas fa-chart-pie"></i>

                <i class="fas fa-star"></i>

                Exclusivo para {{ usuario.nome_completo or 'Você' }}            color: var(--primary-dark);

            </div>

        </div>            margin-bottom: 1.5rem;        /* CARDS KPI PREMIUM */                    <p>Gráfico de distribuição de despesas</p>

    </div>

            display: flex;

    <!-- DASHBOARD MODERNO -->

    <div class="page dashboard-page">            align-items: center;        .kpi-grid {                    <small>Dados insuficientes para exibição</small>

        <h1 class="titulo-secao">Dashboard Financeiro</h1>

            gap: 0.5rem;

        <!-- CARDS KPI PREMIUM -->

        <div class="kpi-grid">        }            display: grid;                </div>

            <div class="kpi-card receita">

                <div class="kpi-icon">

                    <i class="fas fa-arrow-trend-up"></i>

                </div>        .chart-placeholder {            grid-template-columns: repeat(2, 1fr);                {% endif %}

                <div class="kpi-content">

                    <div class="kpi-label">Receita Total</div>            height: 300px;

                    <div class="kpi-value">R$ {{ "%.2f"|format(receita_total|float) }}</div>

                    {% if receita_total|float > 0 %}            background: linear-gradient(135deg, var(--neutral-100), var(--neutral-200));            gap: 2rem;            </div>

                        {% set var_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}

                        <div class="kpi-meta">{% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs mês anterior</div>            border-radius: 16px;

                    {% else %}

                        <div class="kpi-meta">Sem dados anteriores</div>            display: flex;            margin-bottom: 4rem;

                    {% endif %}

                </div>            flex-direction: column;

            </div>

            align-items: center;        }            <div class="grafico-container">

            <div class="kpi-card despesa">

                <div class="kpi-icon">            justify-content: center;

                    <i class="fas fa-arrow-trend-down"></i>

                </div>            color: var(--neutral-600);                <h3><i class="fas fa-chart-line"></i> Evolução Mensal</h3>

                <div class="kpi-content">

                    <div class="kpi-label">Despesa Total</div>            border: 2px dashed var(--neutral-300);

                    <div class="kpi-value">R$ {{ "%.2f"|format(despesa_total|float) }}</div>

                    {% if despesa_total|float > 0 %}        }        .kpi-card {                <div class="grafico-placeholder">

                        {% set var_despesa = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}

                        <div class="kpi-meta">{% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs mês anterior</div>

                    {% else %}

                        <div class="kpi-meta">Sem dados anteriores</div>        .chart-placeholder i {            background: white;                    <i class="fas fa-chart-line"></i>

                    {% endif %}

                </div>            font-size: 3rem;

            </div>

            margin-bottom: 1rem;            border-radius: 24px;                    <p>Evolução das receitas e despesas</p>

            <div class="kpi-card saldo">

                <div class="kpi-icon">            opacity: 0.6;

                    <i class="fas fa-wallet"></i>

                </div>        }            padding: 2rem;                    <small>Últimos 6 meses</small>

                <div class="kpi-content">

                    <div class="kpi-label">Saldo Líquido</div>

                    <div class="kpi-value">R$ {{ "%.2f"|format(saldo_mes|float) }}</div>

                    <div class="kpi-meta">Resultado do mês</div>        /* MINI CALENDÁRIO */            box-shadow: 0 20px 40px rgba(0,0,0,0.1);                </div>

                </div>

            </div>        .calendar-section {



            <div class="kpi-card poupanca">            background: white;            border: 1px solid var(--neutral-200);            </div>

                <div class="kpi-icon">

                    <i class="fas fa-piggy-bank"></i>            border-radius: 24px;

                </div>

                <div class="kpi-content">            padding: 2rem;            position: relative;        </div>

                    <div class="kpi-label">Taxa de Poupança</div>

                    <div class="kpi-value">{{ "%.1f"|format(taxa_poupanca|float) }}%</div>            margin: 4rem 0;

                    <div class="kpi-meta">Meta: 20%</div>

                </div>            box-shadow: 0 20px 40px rgba(0,0,0,0.1);            overflow: hidden;    </div>

            </div>

        </div>        }



        <!-- SCORE FINANCEIRO -->            transition: transform 0.3s ease, box-shadow 0.3s ease;

        <div class="score-section">

            <h2 class="text-2xl font-bold mb-6">Score Financeiro do Mês</h2>        .calendar-title {

            {% set score_poupanca = (taxa_poupanca|float / 20 * 25) if taxa_poupanca|float <= 20 else 25 %}

            {% set score_saldo = 25 if saldo_mes >= 0 else (25 + (saldo_mes / despesa_total|float * 100)) if despesa_total > 0 else 0 %}            font-size: 1.5rem;        }    <!-- ANÁLISE DETALHADA -->

            {% set score_diversificacao = 20 %}

            {% set score_consistencia = 30 %}            font-weight: 700;

            {% set score_total = score_poupanca + score_saldo + score_diversificacao + score_consistencia %}

            color: var(--primary-dark);    <div class="page analise-page">

            <div class="score-circle">

                <div class="score-number">{{ "%.0f"|format(score_total) }}</div>            margin-bottom: 2rem;

                <div class="score-label">

                    {% if score_total >= 80 %}Excelente{% elif score_total >= 60 %}Bom{% elif score_total >= 40 %}Regular{% else %}Precisa Melhorar{% endif %}            text-align: center;        .kpi-card:hover {        <h1 class="titulo-pagina"><i class="fas fa-analytics"></i> Análise Detalhada</h1>

                </div>

            </div>        }



            <div class="score-breakdown">            transform: translateY(-4px);

                <div class="score-item">

                    <div class="text-sm font-semibold text-neutral-600">Poupança</div>        .calendar-grid {

                    <div class="score-bar-bg">

                        <div class="score-bar-fill" style="width: {{ (score_poupanca / 25 * 100)|round }}%; background: linear-gradient(90deg, #059669, #10b981);"></div>            display: grid;            box-shadow: 0 32px 64px rgba(0,0,0,0.15);        {% if gastos_agrupados %}

                    </div>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_poupanca) }}/25</div>            grid-template-columns: repeat(7, 1fr);

                </div>

                <div class="score-item">            gap: 0.5rem;        }        <div class="tabela-container">

                    <div class="text-sm font-semibold text-neutral-600">Saldo</div>

                    <div class="score-bar-bg">            margin-bottom: 1rem;

                        <div class="score-bar-fill" style="width: {{ (score_saldo / 25 * 100)|round }}%; background: linear-gradient(90deg, #7c3aed, #8b5cf6);"></div>

                    </div>        }            <h3><i class="fas fa-list-alt"></i> Gastos por Categoria</h3>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_saldo) }}/25</div>

                </div>

                <div class="score-item">

                    <div class="text-sm font-semibold text-neutral-600">Diversificação</div>        .calendar-day {        .kpi-card::before {            <table class="tabela-moderna">

                    <div class="score-bar-bg">

                        <div class="score-bar-fill" style="width: {{ (score_diversificacao / 20 * 100)|round }}%; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>            aspect-ratio: 1;

                    </div>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_diversificacao) }}/20</div>            border-radius: 8px;            content: '';                <thead>

                </div>

                <div class="score-item">            display: flex;

                    <div class="text-sm font-semibold text-neutral-600">Consistência</div>

                    <div class="score-bar-bg">            align-items: center;            position: absolute;                    <tr>

                        <div class="score-bar-fill" style="width: {{ (score_consistencia / 30 * 100)|round }}%; background: linear-gradient(90deg, #dc2626, #ef4444);"></div>

                    </div>            justify-content: center;

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_consistencia) }}/30</div>

                </div>            font-size: 0.8rem;            top: 0;                        <th><i class="fas fa-tag"></i> Categoria</th>

            </div>

        </div>            font-weight: 600;



        <!-- GRÁFICOS -->            transition: all 0.2s ease;            left: 0;                        <th><i class="fas fa-money-bill-wave"></i> Total Gasto</th>

        <div class="charts-grid">

            <div class="chart-card">        }

                <h3 class="chart-title">

                    <i class="fas fa-chart-pie"></i>            right: 0;                        <th><i class="fas fa-percentage"></i> % do Total</th>

                    Distribuição de Despesas

                </h3>        .calendar-day.positive {

                {% if grafico_pizza_base64 %}

                <img src="data:image/png;base64,{{ grafico_pizza_base64 }}" alt="Gráfico de Despesas" style="width: 100%; border-radius: 12px;">            background: var(--pastel-green);            height: 4px;                        <th><i class="fas fa-chart-bar"></i> Tendência</th>

                {% else %}

                <div class="chart-placeholder">            color: var(--success);

                    <i class="fas fa-chart-pie"></i>

                    <div class="text-lg font-semibold">Gráfico 3D de Pizza</div>        }            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));                    </tr>

                    <div class="text-sm text-neutral-500">Dados insuficientes</div>

                </div>

                {% endif %}

            </div>        .calendar-day.negative {        }                </thead>



            <div class="chart-card">            background: #fef2f2;

                <h3 class="chart-title">

                    <i class="fas fa-chart-line"></i>            color: var(--danger);                <tbody>

                    Evolução Mensal

                </h3>        }

                <div class="chart-placeholder">

                    <i class="fas fa-chart-line"></i>        .kpi-card.receita::before { background: linear-gradient(90deg, #059669, #10b981); }                    {% for categoria, valor in gastos_agrupados %}

                    <div class="text-lg font-semibold">Gráfico de Área</div>

                    <div class="text-sm text-neutral-500">Evolução últimos 6 meses</div>        .calendar-day.neutral {

                </div>

            </div>            background: var(--neutral-100);        .kpi-card.despesa::before { background: linear-gradient(90deg, #dc2626, #ef4444); }                    {% set cores_categorias = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1',

        </div>

            color: var(--neutral-600);

        <!-- MINI CALENDÁRIO -->

        <div class="calendar-section">        }        .kpi-card.saldo::before { background: linear-gradient(90deg, #7c3aed, #8b5cf6); }                    '#fd7e14', '#20c997'] %}

            <h3 class="calendar-title">

                <i class="fas fa-calendar-days"></i>

                Calendário Financeiro do Mês

            </h3>        /* TABELAS MODERNAS */        .kpi-card.poupanca::before { background: linear-gradient(90deg, #f59e0b, #fbbf24); }                    <tr>

            <div class="calendar-grid">

                <!-- Dias do mês (simplificado - em produção seria dinâmico) -->        .table-section {

                {% for day in range(1, 31) %}

                <div class="calendar-day {% if day % 3 == 0 %}positive{% elif day % 5 == 0 %}negative{% else %}neutral{% endif %}">            background: white;                        <td>

                    {{ day }}

                </div>            border-radius: 24px;

                {% endfor %}

            </div>            padding: 2rem;        .kpi-icon {                            <div class="categoria-cell">

            <div class="text-center text-sm text-neutral-600 mt-4">

                <span class="inline-flex items-center gap-2 mr-4">            margin: 4rem 0;

                    <div class="w-3 h-3 bg-green-100 rounded-full"></div>

                    Dias positivos            box-shadow: 0 20px 40px rgba(0,0,0,0.1);            position: absolute;                                <i class="fas fa-circle categoria-color"

                </span>

                <span class="inline-flex items-center gap-2 mr-4">            overflow: hidden;

                    <div class="w-3 h-3 bg-red-100 rounded-full"></div>

                    Dias negativos        }            top: 1.5rem;                                    style="color: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></i>

                </span>

                <span class="inline-flex items-center gap-2">

                    <div class="w-3 h-3 bg-neutral-100 rounded-full"></div>

                    Dias neutros        .table-title {            right: 1.5rem;                                {{ categoria }}

                </span>

            </div>            font-size: 1.5rem;

        </div>

    </div>            font-weight: 700;            width: 48px;                            </div>



    <!-- ANÁLISE DETALHADA -->            color: var(--primary-dark);

    <div class="page">

        <h1 class="titulo-secao">Análise Detalhada</h1>            margin-bottom: 2rem;            height: 48px;                        </td>



        {% if gastos_agrupados %}            display: flex;

        <div class="table-section">

            <h3 class="table-title">            align-items: center;            border-radius: 50%;                        <td class="valor-cell">R$ {{ "%.2f"|format(valor|float) }}</td>

                <i class="fas fa-list-alt"></i>

                Gastos por Categoria            gap: 0.5rem;

            </h3>

            <table class="modern-table">        }            display: flex;                        <td>

                <thead>

                    <tr>

                        <th>Categoria</th>

                        <th>Total Gasto</th>        .modern-table {            align-items: center;                            <div class="percent-bar">

                        <th>% do Total</th>

                        <th>Tendência</th>            width: 100%;

                    </tr>

                </thead>            border-collapse: separate;            justify-content: center;                                <div class="percent-fill"

                <tbody>

                    {% for categoria, valor in gastos_agrupados %}            border-spacing: 0;

                    {% set cores_categorias = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1', '#fd7e14', '#20c997'] %}

                    <tr>        }            font-size: 1.25rem;                                    style="width: {{ (valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0 }}%">

                        <td>

                            <div class="category-cell">

                                <div class="category-dot" style="background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>

                                {{ categoria }}        .modern-table thead th {        }                                </div>

                            </div>

                        </td>            background: var(--primary-dark);

                        <td class="text-right font-semibold">R$ {{ "%.2f"|format(valor|float) }}</td>

                        <td>            color: white;                                <span class="percent-text">{{ "%.1f"|format((valor|float / despesa_total|float) * 100 if

                            <div class="flex items-center gap-2">

                                <div class="progress-bar">            padding: 1rem;

                                    <div class="progress-fill" style="width: {{ (valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0 }}%; background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>

                                </div>            text-align: left;        .kpi-card.receita .kpi-icon { background: var(--pastel-green); color: var(--success); }                                    despesa_total > 0 else 0) }}%</span>

                                <span class="text-sm font-medium">{{ "%.1f"|format((valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0) }}%</span>

                            </div>            font-weight: 600;

                        </td>

                        <td>            font-size: 0.9rem;        .kpi-card.despesa .kpi-icon { background: #fef2f2; color: var(--danger); }                            </div>

                            {% set variacao = ((valor|float / (despesa_total|float * 1.05)) - 1) * 100 if despesa_total > 0 else 0 %}

                            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium            text-transform: uppercase;

                                {% if variacao >= 0 %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">

                                <i class="fas fa-arrow-{% if variacao >= 0 %}up{% else %}down{% endif %}"></i>            letter-spacing: 0.05em;        .kpi-card.saldo .kpi-icon { background: var(--pastel-purple); color: var(--primary-purple); }                        </td>

                                {% if variacao >= 0 %}+{% endif %}{{ "%.1f"|format(variacao) }}%

                            </span>            border: none;

                        </td>

                    </tr>        }        .kpi-card.poupanca .kpi-icon { background: var(--pastel-yellow); color: var(--warning); }                        <td>

                    {% endfor %}

                </tbody>

            </table>

        </div>        .modern-table tbody tr:nth-child(even) {                            {% set variacao = ((valor|float / (despesa_total|float * 1.05)) - 1) * 100 if despesa_total

        {% endif %}

            background: var(--neutral-50);

        <!-- INDICADORES -->

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">        }        .kpi-label {                            > 0 else 0 %}

            <div class="bg-white rounded-2xl p-6 shadow-lg">

                <div class="flex items-center gap-4 mb-4">

                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">

                        <i class="fas fa-calculator text-blue-600"></i>        .modern-table tbody td {            font-size: 0.9rem;                            <span class="tendencia {% if variacao >= 0 %}alta{% else %}baixa{% endif %}">

                    </div>

                    <div>            padding: 1rem;

                        <div class="text-sm font-semibold text-neutral-600">Gasto Médio Diário</div>

                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format((despesa_total|float / 30) if despesa_total else 0) }}</div>            border-bottom: 1px solid var(--neutral-200);            font-weight: 600;                                <i class="fas fa-arrow-{% if variacao >= 0 %}up{% else %}down{% endif %}"></i>

                    </div>

                </div>            font-size: 0.9rem;

            </div>

        }            color: var(--neutral-600);                                {% if variacao >= 0 %}+{% endif %}{{ "%.1f"|format(variacao) }}%

            <div class="bg-white rounded-2xl p-6 shadow-lg">

                <div class="flex items-center gap-4 mb-4">

                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">

                        <i class="fas fa-credit-card text-purple-600"></i>        .category-cell {            margin-bottom: 0.5rem;                            </span>

                    </div>

                    <div>            display: flex;

                        <div class="text-sm font-semibold text-neutral-600">Maior Gasto</div>

                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float if gastos_agrupados else 0) }}</div>            align-items: center;            text-transform: uppercase;                        </td>

                        <div class="text-sm text-neutral-500">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>

                    </div>            gap: 0.75rem;

                </div>

            </div>        }            letter-spacing: 0.05em;                    </tr>



            <div class="bg-white rounded-2xl p-6 shadow-lg">

                <div class="flex items-center gap-4 mb-4">

                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">        .category-dot {        }                    {% endfor %}

                        <i class="fas fa-trophy text-yellow-600"></i>

                    </div>            width: 12px;

                    <div>

                        <div class="text-sm font-semibold text-neutral-600">Categoria Prioritária</div>            height: 12px;                </tbody>

                        <div class="text-2xl font-bold text-neutral-900">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>

                        <div class="text-sm text-neutral-500">{{ "%.1f"|format((gastos_agrupados[0][1]|float / despesa_total|float) * 100 if gastos_agrupados and despesa_total > 0 else 0) }}% do total</div>            border-radius: 50%;

                    </div>

                </div>        }        .kpi-value {            </table>

            </div>

        </div>

    </div>

        .progress-bar {            font-size: 2.5rem;        </div>

    <!-- INSIGHTS & RECOMENDAÇÕES -->

    <div class="page">            width: 100px;

        <div class="insights-section">

            <h1 class="insights-title">Descobertas Inteligentes</h1>            height: 8px;            font-weight: 800;        {% endif %}



            <div class="insights-grid">            background: var(--neutral-200);

                <!-- Insight sobre padrão de gastos -->

                <div class="insight-card positive">            border-radius: 4px;            color: var(--primary-dark);

                    <div class="insight-icon">

                        <i class="fas fa-lightbulb"></i>            overflow: hidden;

                    </div>

                    <h4 class="insight-title">Padrão de Gastos Identificado</h4>        }            margin-bottom: 0.5rem;        <div class="indicadores-container">

                    {% if gastos_agrupados %}

                    {% set categoria_principal = gastos_agrupados[0][0] %}

                    {% set percentual_principal = (gastos_agrupados[0][1]|float / despesa_total|float * 100) if despesa_total > 0 else 0 %}

                    <p class="insight-text">        .progress-fill {        }            <div class="indicador-box">

                        <strong>{{ "%.1f"|format(percentual_principal) }}%</strong> dos seus gastos se concentram em <strong>{{ categoria_principal }}</strong>.

                        {% if percentual_principal > 40 %}            height: 100%;

                        Que tal reduzir 15% nessa categoria e economizar R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float * 0.15) }} mensais?

                        {% elif percentual_principal > 25 %}            border-radius: 4px;                <h4><i class="fas fa-calculator"></i> Gasto Médio Diário</h4>

                        Ótimo equilíbrio! Continue diversificando seus gastos.

                        {% else %}            transition: width 0.3s ease;

                        Excelente distribuição - você está no caminho certo!

                        {% endif %}        }        .kpi-meta {                <p class="indicador-valor">R$ {{ "%.2f"|format((despesa_total|float / 30) if despesa_total else 0) }}

                    </p>

                    {% else %}

                    <p class="insight-text">Continue registrando seus gastos para descobertas personalizadas!</p>

                    {% endif %}        /* INSIGHTS */            font-size: 0.8rem;                </p>

                </div>

        .insights-section {

                <!-- Insight sobre economia -->

                <div class="insight-card warning">            background: linear-gradient(135deg, var(--pastel-blue), var(--pastel-purple));            color: var(--neutral-600);                <small>Baseado em 30 dias</small>

                    <div class="insight-icon">

                        <i class="fas fa-piggy-bank"></i>            border-radius: 24px;

                    </div>

                    <h4 class="insight-title">Oportunidade de Economia</h4>            padding: 3rem;            font-weight: 500;            </div>

                    {% if gastos_agrupados and gastos_agrupados|length >= 2 %}

                    {% set segunda_categoria = gastos_agrupados[1][0] %}            margin: 4rem 0;

                    {% set valor_economia = gastos_agrupados[1][1]|float * 0.15 %}

                    <p class="insight-text">        }        }            <div class="indicador-box">

                        Reduzindo apenas <strong>15%</strong> dos gastos em <strong>{{ segunda_categoria }}</strong>,

                        você economizaria <strong>R$ {{ "%.2f"|format(valor_economia) }}</strong> este mês.

                        Em um ano, isso vira <strong>R$ {{ "%.2f"|format(valor_economia * 12) }}</strong>!

                    </p>        .insights-title {                <h4><i class="fas fa-credit-card"></i> Maior Gasto</h4>

                    {% else %}

                    <p class="insight-text">Mais dados = mais oportunidades de economia personalizadas.</p>            font-size: 2rem;

                    {% endif %}

                </div>            font-weight: 800;        /* SCORE FINANCEIRO */                <p class="indicador-valor">R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float if gastos_agrupados else 0)



                <!-- Insight sobre performance -->            color: var(--primary-dark);

                <div class="insight-card info">

                    <div class="insight-icon">            text-align: center;        .score-section {                    }}</p>

                        <i class="fas fa-trophy"></i>

                    </div>            margin-bottom: 3rem;

                    <h4 class="insight-title">Sua Performance</h4>

                    {% if taxa_poupanca|float >= 20 %}        }            background: white;                <small>{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</small>

                    <p class="insight-text">

                        <strong>Parabéns!</strong> Sua taxa de poupança de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong>

                        está acima da meta. Você está construindo riqueza de verdade!

                    </p>        .insights-grid {            border-radius: 24px;            </div>

                    {% elif taxa_poupanca|float >= 10 %}

                    <p class="insight-text">            display: grid;

                        Taxa de poupança intermediária. Com pequenos ajustes, você chega aos 20% facilmente.

                    </p>            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));            padding: 3rem;            <div class="indicador-box">

                    {% else %}

                    <p class="insight-text">            gap: 2rem;

                        Todo começo é válido. Cada real poupado é uma vitória rumo à independência financeira.

                    </p>        }            margin: 4rem 0;                <h4><i class="fas fa-trophy"></i> Categoria Prioritária</h4>

                    {% endif %}

                </div>

            </div>

        </div>        .insight-card {            box-shadow: 0 20px 40px rgba(0,0,0,0.1);                <p class="indicador-valor">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</p>

    </div>

            background: white;

    <!-- RODAPÉ PREMIUM -->

    <div class="page footer-section">            border-radius: 20px;            text-align: center;                <small>{{ "%.1f"|format((gastos_agrupados[0][1]|float / despesa_total|float) * 100 if gastos_agrupados

        <div class="footer-logo">

            <i class="fas fa-crown"></i>            padding: 2rem;

        </div>

        <h2 class="footer-title">Maestro Financeiro Premium</h2>            box-shadow: 0 16px 32px rgba(0,0,0,0.1);        }                    and despesa_total > 0 else 0) }}% do total</small>



        <div class="footer-stats">            border: 1px solid var(--neutral-200);

            <div class="stat-item">

                <i class="fas fa-calendar"></i>        }            </div>

                <span>Período: {{ mes_nome }} {{ ano }}</span>

            </div>

            <div class="stat-item">

                <i class="fas fa-clock"></i>        .insight-icon {        .score-circle {        </div>

                <span>Gerado: {{ now().strftime('%d/%m/%Y %H:%M') }}</span>

            </div>            width: 56px;

            <div class="stat-item">

                <i class="fas fa-file-pdf"></i>            height: 56px;            width: 160px;    </div>

                <span>Relatório Premium v3.0</span>

            </div>            border-radius: 50%;

        </div>

            display: flex;            height: 160px;

        <div class="qr-section">

            <div class="qr-placeholder">            align-items: center;

                <i class="fas fa-qrcode text-4xl text-neutral-400"></i>

            </div>            justify-content: center;            border-radius: 50%;    <!-- DESCOBERTAS DO MÊS -->

            <div class="text-sm font-semibold text-neutral-700 mb-2">Acesse seu bot</div>

            <div class="text-xs text-neutral-500">Toque para conversar com o Maestro</div>            font-size: 1.5rem;

        </div>

            margin-bottom: 1.5rem;            background: conic-gradient(from 0deg, #059669 0%, #10b981 25%, #f59e0b 50%, #f97316 75%, #dc2626 100%);    <div class="page descobertas-page">

        <div class="confidential-badge">

            <i class="fas fa-shield-alt"></i>        }

            Relatório Confidencial - Exclusivo

        </div>            display: flex;        <h1 class="titulo-pagina"><i class="fas fa-search"></i> Descobertas do Mês</h1>

    </div>

</body>        .insight-card.positive .insight-icon {



</html>            background: var(--pastel-green);            flex-direction: column;

            color: var(--success);

        }            align-items: center;        <div class="descobertas-container">



        .insight-card.warning .insight-icon {            justify-content: center;            <h3><i class="fas fa-lightbulb"></i> O que descobrimos sobre seus hábitos financeiros</h3>

            background: var(--pastel-yellow);

            color: var(--warning);            margin: 0 auto 2rem;

        }

            position: relative;            <div class="descobertas-grid">

        .insight-card.info .insight-icon {

            background: var(--pastel-blue);            box-shadow: 0 20px 40px rgba(0,0,0,0.2);                <!-- Descoberta sobre padrão de gastos -->

            color: var(--primary-blue);

        }        }                <div class="descoberta-card destaque">



        .insight-title {                    <div class="descoberta-icon">

            font-size: 1.25rem;

            font-weight: 700;        .score-circle::before {                        <i class="fas fa-chart-line"></i>

            color: var(--primary-dark);

            margin-bottom: 1rem;            content: '';                    </div>

        }

            position: absolute;                    <h4>Padrão de Gastos Identificado</h4>

        .insight-text {

            color: var(--neutral-600);            inset: 8px;                    {% if gastos_agrupados %}

            line-height: 1.6;

        }            border-radius: 50%;                    {% set categoria_principal = gastos_agrupados[0][0] %}



        /* RODAPÉ PREMIUM */            background: white;                    {% set percentual_principal = (gastos_agrupados[0][1]|float / despesa_total|float * 100) if

        .footer-section {

            background: var(--primary-dark);        }                    despesa_total > 0 else 0 %}

            color: white;

            padding: 4rem 2rem;                    <p><strong>{{ "%.1f"|format(percentual_principal) }}%</strong> dos seus gastos se concentram em

            text-align: center;

            position: relative;        .score-number {                        <strong>{{ categoria_principal }}</strong>.

        }

            font-size: 3rem;                        {% if percentual_principal > 40 %}

        .footer-section::before {

            content: '';            font-weight: 900;                        Isso indica uma alta concentração - considere diversificar ou revisar essa categoria.

            position: absolute;

            top: 0;            color: var(--primary-dark);                        {% elif percentual_principal > 25 %}

            left: 0;

            right: 0;            position: relative;                        Essa é uma concentração saudável, mantendo o foco sem exageros.

            height: 4px;

            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));            z-index: 1;                        {% else %}

        }

        }                        Você tem gastos bem distribuídos, o que demonstra equilíbrio financeiro.

        .footer-logo {

            font-size: 2.5rem;                        {% endif %}

            margin-bottom: 1rem;

            opacity: 0.9;        .score-label {                    </p>

        }

            font-size: 1.1rem;                    {% else %}

        .footer-title {

            font-size: 1.5rem;            font-weight: 700;                    <p>Ainda não temos dados suficientes para identificar padrões. Continue registrando seus gastos!</p>

            font-weight: 700;

            margin-bottom: 2rem;            color: var(--neutral-600);                    {% endif %}

        }

            position: relative;                </div>

        .footer-stats {

            display: grid;            z-index: 1;

            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));

            gap: 2rem;        }                <!-- Descoberta sobre economia potencial -->

            margin: 3rem 0;

        }                <div class="descoberta-card economia">



        .stat-item {        .score-breakdown {                    <div class="descoberta-icon">

            display: flex;

            align-items: center;            display: grid;                        <i class="fas fa-piggy-bank"></i>

            justify-content: center;

            gap: 0.75rem;            grid-template-columns: repeat(4, 1fr);                    </div>

            padding: 1rem;

            background: rgba(255,255,255,0.1);            gap: 1.5rem;                    <h4>Potencial de Economia</h4>

            border-radius: 12px;

            backdrop-filter: blur(10px);            margin-top: 2rem;                    {% if gastos_agrupados and gastos_agrupados|length >= 2 %}

        }

        }                    {% set segunda_categoria = gastos_agrupados[1][0] %}

        .qr-section {

            margin-top: 3rem;                    {% set valor_economia = gastos_agrupados[1][1]|float * 0.15 %}

            padding: 2rem;

            background: white;        .score-item {                    <p>Reduzindo apenas <strong>15%</strong> dos gastos em <strong>{{ segunda_categoria }}</strong>,

            border-radius: 16px;

            display: inline-block;            text-align: center;                        você economizaria <strong>R$ {{ "%.2f"|format(valor_economia) }}</strong> este mês. Em um ano,

        }

        }                        isso resultaria em <strong>R$ {{ "%.2f"|format(valor_economia * 12) }}</strong>!</p>

        .qr-placeholder {

            width: 120px;                    {% else %}

            height: 120px;

            background: var(--neutral-200);        .score-bar-bg {                    <p>Com mais dados de gastos, poderemos identificar oportunidades específicas de economia para você.

            border-radius: 8px;

            display: flex;            height: 8px;                    </p>

            align-items: center;

            justify-content: center;            background: var(--neutral-200);                    {% endif %}

            margin: 0 auto 1rem;

        }            border-radius: 4px;                </div>



        .confidential-badge {            margin: 0.5rem 0;

            display: inline-block;

            background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));            overflow: hidden;                <!-- Descoberta sobre performance financeira -->

            color: var(--primary-dark);

            padding: 8px 16px;        }                <div class="descoberta-card performance">

            border-radius: 20px;

            font-weight: 700;                    <div class="descoberta-icon">

            font-size: 0.8rem;

            margin-top: 1rem;        .score-bar-fill {                        <i class="fas fa-trophy"></i>

        }

            height: 100%;                    </div>

        /* RESPONSIVIDADE */

        @media (max-width: 768px) {            border-radius: 4px;                    <h4>Performance do Mês</h4>

            .page {

                padding: 20px;            transition: width 0.3s ease;                    {% if taxa_poupanca|float >= 20 %}

            }

        }                    <p><strong>Parabéns!</strong> Sua taxa de poupança de <strong>{{ "%.1f"|format(taxa_poupanca|float)

            .titulo-premium {

                font-size: 2.5rem;                            }}%</strong> está acima da recomendação geral (20%). Você está no caminho certo para a

            }

        /* GRÁFICOS */                        independência financeira!</p>

            .kpi-grid {

                grid-template-columns: 1fr;        .charts-grid {                    {% elif taxa_poupanca|float >= 10 %}

            }

            display: grid;                    <p>Sua taxa de poupança de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong> está em um

            .charts-grid {

                grid-template-columns: 1fr;            grid-template-columns: 1fr 1fr;                        nível intermediário. Com alguns ajustes, você pode facilmente chegar aos 20% recomendados.</p>

            }

            gap: 2rem;                    {% elif taxa_poupanca|float > 0 %}

            .score-breakdown {

                grid-template-columns: repeat(2, 1fr);            margin: 4rem 0;                    <p>Mesmo com uma taxa de poupança de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong>, o

            }

        }        }                        importante é que você está poupando! Cada real guardado é um passo em direção aos seus

    </style>

</head>                        objetivos.</p>



<body>        .chart-card {                    {% else %}

    <!-- CAPA PREMIUM -->

    <div class="page capa-page">            background: white;                    <p>Este mês foi desafiador com saldo negativo, mas isso é normal. O importante é identificar os

        <div class="capa-container">

            <div class="logo-premium">            border-radius: 24px;                        padrões e fazer ajustes para o próximo mês.</p>

                <i class="fas fa-crown"></i>

            </div>            padding: 2rem;                    {% endif %}

            <h1 class="titulo-premium">Relatório Financeiro</h1>

            <h2 class="periodo-premium">01 a {{ now().strftime('%d') }} de {{ mes_nome }} de {{ ano }}</h2>            box-shadow: 0 20px 40px rgba(0,0,0,0.1);                </div>



            <div class="avatar-container">        }

                <div class="avatar-placeholder">

                    <i class="fas fa-user"></i>                <!-- Descoberta sobre comparativo temporal -->

                </div>

            </div>        .chart-title {                <div class="descoberta-card temporal">



            <div class="badge-premium">            font-size: 1.5rem;                    <div class="descoberta-icon">

                <i class="fas fa-star"></i>

                Exclusivo para {{ usuario.nome_completo or 'Você' }}            font-weight: 700;                        <i class="fas fa-calendar-alt"></i>

            </div>

        </div>            color: var(--primary-dark);                    </div>

    </div>

            margin-bottom: 1.5rem;                    <h4>Evolução Temporal</h4>

    <!-- DASHBOARD MODERNO -->

    <div class="page dashboard-page">            display: flex;                    {% if receita_total|float > 0 %}

        <h1 class="titulo-secao">Dashboard Financeiro</h1>

            align-items: center;                        {% set crescimento_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}

        <!-- CARDS KPI PREMIUM -->

        <div class="kpi-grid">            gap: 0.5rem;                    {% else %}

            <div class="kpi-card receita">

                <div class="kpi-icon">        }                        {% set crescimento_receita = 0 %}

                    <i class="fas fa-arrow-trend-up"></i>

                </div>                    {% endif %}

                <div class="kpi-content">

                    <div class="kpi-label">Receita Total</div>        .chart-placeholder {                    

                    <div class="kpi-value">R$ {{ "%.2f"|format(receita_total|float) }}</div>

                    {% if receita_total|float > 0 %}            height: 300px;                    {% if despesa_total|float > 0 %}

                        {% set var_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}

                        <div class="kpi-meta">{% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs mês anterior</div>            background: linear-gradient(135deg, var(--neutral-100), var(--neutral-200));                        {% set reducao_despesa = ((1 - (despesa_total|float / (despesa_total|float * 1.05))) * 100) %}

                    {% else %}

                        <div class="kpi-meta">Sem dados anteriores</div>            border-radius: 16px;                    {% else %}

                    {% endif %}

                </div>            display: flex;                        {% set reducao_despesa = 0 %}

            </div>

            flex-direction: column;                    {% endif %}

            <div class="kpi-card despesa">

                <div class="kpi-icon">            align-items: center;

                    <i class="fas fa-arrow-trend-down"></i>

                </div>            justify-content: center;                    <p>Comparado à média dos últimos meses: suas receitas

                <div class="kpi-content">

                    <div class="kpi-label">Despesa Total</div>            color: var(--neutral-600);                        {% if crescimento_receita > 0 %}

                    <div class="kpi-value">R$ {{ "%.2f"|format(despesa_total|float) }}</div>

                    {% if despesa_total|float > 0 %}            border: 2px dashed var(--neutral-300);                        <strong>cresceram {{ "%.1f"|format(crescimento_receita) }}%</strong> 📈

                        {% set var_despesa = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}

                        <div class="kpi-meta">{% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs mês anterior</div>        }                        {% else %}

                    {% else %}

                        <div class="kpi-meta">Sem dados anteriores</div>                        <strong>diminuíram {{ "%.1f"|format(crescimento_receita|abs) }}%</strong> 📉

                    {% endif %}

                </div>        .chart-placeholder i {                        {% endif %}

            </div>

            font-size: 3rem;                        e você conseguiu

            <div class="kpi-card saldo">

                <div class="kpi-icon">            margin-bottom: 1rem;                        {% if reducao_despesa > 0 %}

                    <i class="fas fa-wallet"></i>

                </div>            opacity: 0.6;                        <strong>reduzir {{ "%.1f"|format(reducao_despesa) }}%</strong> das despesas. Excelente controle!

                <div class="kpi-content">

                    <div class="kpi-label">Saldo Líquido</div>        }                        🎯

                    <div class="kpi-value">R$ {{ "%.2f"|format(saldo_mes|float) }}</div>

                    <div class="kpi-meta">Resultado do mês</div>                        {% else %}

                </div>

            </div>        /* MINI CALENDÁRIO */                        um <strong>aumento de {{ "%.1f"|format(reducao_despesa|abs) }}%</strong> nas despesas. Vale



            <div class="kpi-card poupanca">        .calendar-section {                        revisar onde houve o aumento. 🔍

                <div class="kpi-icon">

                    <i class="fas fa-piggy-bank"></i>            background: white;                        {% endif %}

                </div>

                <div class="kpi-content">            border-radius: 24px;                    </p>

                    <div class="kpi-label">Taxa de Poupança</div>

                    <div class="kpi-value">{{ "%.1f"|format(taxa_poupanca|float) }}%</div>            padding: 2rem;                </div>

                    <div class="kpi-meta">Meta: 20%</div>

                </div>            margin: 4rem 0;            </div>

            </div>

        </div>            box-shadow: 0 20px 40px rgba(0,0,0,0.1);        </div>



        <!-- SCORE FINANCEIRO -->        }    </div>

        <div class="score-section">

            <h2 class="text-2xl font-bold mb-6">Score Financeiro do Mês</h2>

            {% set score_poupanca = (taxa_poupanca|float / 20 * 25) if taxa_poupanca|float <= 20 else 25 %}

            {% set score_saldo = 25 if saldo_mes >= 0 else (25 + (saldo_mes / despesa_total|float * 100)) if despesa_total > 0 else 0 %}        .calendar-title {    <!-- INSIGHTS E RECOMENDAÇÕES -->

            {% set score_diversificacao = 20 %}

            {% set score_consistencia = 30 %}            font-size: 1.5rem;    <div class="page insights-page">

            {% set score_total = score_poupanca + score_saldo + score_diversificacao + score_consistencia %}

            font-weight: 700;        <h1 class="titulo-pagina"><i class="fas fa-lightbulb"></i> Insights e Recomendações</h1>

            <div class="score-circle">

                <div class="score-number">{{ "%.0f"|format(score_total) }}</div>            color: var(--primary-dark);

                <div class="score-label">

                    {% if score_total >= 80 %}Excelente{% elif score_total >= 60 %}Bom{% elif score_total >= 40 %}Regular{% else %}Precisa Melhorar{% endif %}            margin-bottom: 2rem;        {% if analise_ia %}

                </div>

            </div>            text-align: center;        <div class="analise-container">



            <div class="score-breakdown">        }            <h3><i class="fas fa-robot"></i> Análise Inteligente do Maestro</h3>

                <div class="score-item">

                    <div class="text-sm font-semibold text-neutral-600">Poupança</div>            <div class="texto-analise">{{ analise_ia|safe }}</div>

                    <div class="score-bar-bg">

                        <div class="score-bar-fill" style="width: {{ (score_poupanca / 25 * 100)|round }}%; background: linear-gradient(90deg, #059669, #10b981);"></div>        .calendar-grid {        </div>

                    </div>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_poupanca) }}/25</div>            display: grid;        {% endif %}

                </div>

                <div class="score-item">            grid-template-columns: repeat(7, 1fr);

                    <div class="text-sm font-semibold text-neutral-600">Saldo</div>

                    <div class="score-bar-bg">            gap: 0.5rem;        <div class="recomendacoes-container">

                        <div class="score-bar-fill" style="width: {{ (score_saldo / 25 * 100)|round }}%; background: linear-gradient(90deg, #7c3aed, #8b5cf6);"></div>

                    </div>            margin-bottom: 1rem;            <h3><i class="fas fa-star"></i> Recomendações Personalizadas</h3>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_saldo) }}/25</div>

                </div>        }            <div class="recomendacoes-grid">

                <div class="score-item">

                    <div class="text-sm font-semibold text-neutral-600">Diversificação</div>                <div class="recomendacao-card economia">

                    <div class="score-bar-bg">

                        <div class="score-bar-fill" style="width: {{ (score_diversificacao / 20 * 100)|round }}%; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>        .calendar-day {                    <div class="recomendacao-icon">

                    </div>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_diversificacao) }}/20</div>            aspect-ratio: 1;                        <i class="fas fa-piggy-bank"></i>

                </div>

                <div class="score-item">            border-radius: 8px;                    </div>

                    <div class="text-sm font-semibold text-neutral-600">Consistência</div>

                    <div class="score-bar-bg">            display: flex;                    <h4>Oportunidade de Economia</h4>

                        <div class="score-bar-fill" style="width: {{ (score_consistencia / 30 * 100)|round }}%; background: linear-gradient(90deg, #dc2626, #ef4444);"></div>

                    </div>            align-items: center;                    <p>Considere revisar gastos em {{ gastos_agrupados[0][0] if gastos_agrupados else 'alimentação' }}.

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_consistencia) }}/30</div>

                </div>            justify-content: center;                        Uma redução de 10% resultaria em economia de R$ {{ "%.2f"|format((gastos_agrupados[0][1]|float *

            </div>

        </div>            font-size: 0.8rem;                        0.1) if gastos_agrupados else 0) }}.</p>



        <!-- GRÁFICOS -->            font-weight: 600;                </div>

        <div class="charts-grid">

            <div class="chart-card">            transition: all 0.2s ease;

                <h3 class="chart-title">

                    <i class="fas fa-chart-pie"></i>        }                <div class="recomendacao-card investimento">

                    Distribuição de Despesas

                </h3>                    <div class="recomendacao-icon">

                {% if grafico_pizza_base64 %}

                <img src="data:image/png;base64,{{ grafico_pizza_base64 }}" alt="Gráfico de Despesas" style="width: 100%; border-radius: 12px;">        .calendar-day.positive {                        <i class="fas fa-chart-line"></i>

                {% else %}

                <div class="chart-placeholder">            background: var(--pastel-green);                    </div>

                    <i class="fas fa-chart-pie"></i>

                    <div class="text-lg font-semibold">Gráfico 3D de Pizza</div>            color: var(--success);                    <h4>Potencial de Investimento</h4>

                    <div class="text-sm text-neutral-500">Dados insuficientes</div>

                </div>        }                    <p>{% if saldo_mes > 0 %}Com seu saldo positivo de R$ {{ "%.2f"|format(saldo_mes|float) }},

                {% endif %}

            </div>                        considere investir em aplicações que rendam acima da inflação.{% else %}Foque em equilibrar as



            <div class="chart-card">        .calendar-day.negative {                        contas antes de investir. Revise seus gastos fixos.{% endif %}</p>

                <h3 class="chart-title">

                    <i class="fas fa-chart-line"></i>            background: #fef2f2;                </div>

                    Evolução Mensal

                </h3>            color: var(--danger);

                <div class="chart-placeholder">

                    <i class="fas fa-chart-line"></i>        }                <div class="recomendacao-card planejamento">

                    <div class="text-lg font-semibold">Gráfico de Área</div>

                    <div class="text-sm text-neutral-500">Evolução últimos 6 meses</div>                    <div class="recomendacao-icon">

                </div>

            </div>        .calendar-day.neutral {                        <i class="fas fa-calendar-check"></i>

        </div>

            background: var(--neutral-100);                    </div>

        <!-- MINI CALENDÁRIO -->

        <div class="calendar-section">            color: var(--neutral-600);                    <h4>Planejamento Futuro</h4>

            <h3 class="calendar-title">

                <i class="fas fa-calendar-days"></i>        }                    <p>Estabeleça uma reserva de emergência equivalente a 6 meses de gastos. Baseado em seus gastos

                Calendário Financeiro do Mês

            </h3>                        atuais, isso seria R$ {{ "%.2f"|format((despesa_total|float * 6) if despesa_total else 0) }}.

            <div class="calendar-grid">

                <!-- Dias do mês (simplificado - em produção seria dinâmico) -->        /* TABELAS MODERNAS */                    </p>

                {% for day in range(1, 31) %}

                <div class="calendar-day {% if day % 3 == 0 %}positive{% elif day % 5 == 0 %}negative{% else %}neutral{% endif %}">        .table-section {                </div>

                    {{ day }}

                </div>            background: white;            </div>

                {% endfor %}

            </div>            border-radius: 24px;        </div>

            <div class="text-center text-sm text-neutral-600 mt-4">

                <span class="inline-flex items-center gap-2 mr-4">            padding: 2rem;

                    <div class="w-3 h-3 bg-green-100 rounded-full"></div>

                    Dias positivos            margin: 4rem 0;        <div class="alertas-container">

                </span>

                <span class="inline-flex items-center gap-2 mr-4">            box-shadow: 0 20px 40px rgba(0,0,0,0.1);            <h3><i class="fas fa-exclamation-circle"></i> Alertas Importantes</h3>

                    <div class="w-3 h-3 bg-red-100 rounded-full"></div>

                    Dias negativos            overflow: hidden;            <div class="alertas-list">

                </span>

                <span class="inline-flex items-center gap-2">        }                {% if taxa_poupanca|float < 10 %} <div class="alerta warning">

                    <div class="w-3 h-3 bg-neutral-100 rounded-full"></div>

                    Dias neutros                    <i class="fas fa-exclamation-triangle"></i>

                </span>

            </div>        .table-title {                    <div>

        </div>

    </div>            font-size: 1.5rem;                        <strong>Taxa de Poupança Baixa</strong>



    <!-- ANÁLISE DETALHADA -->            font-weight: 700;                        <p>Sua taxa de poupança está abaixo do recomendado (20%). Considere revisar gastos não

    <div class="page">

        <h1 class="titulo-secao">Análise Detalhada</h1>            color: var(--primary-dark);                            essenciais.</p>



        {% if gastos_agrupados %}            margin-bottom: 2rem;                    </div>

        <div class="table-section">

            <h3 class="table-title">            display: flex;            </div>

                <i class="fas fa-list-alt"></i>

                Gastos por Categoria            align-items: center;            {% endif %}

            </h3>

            <table class="modern-table">            gap: 0.5rem;

                <thead>

                    <tr>        }            {% if saldo_mes < 0 %} <div class="alerta danger">

                        <th>Categoria</th>

                        <th>Total Gasto</th>                <i class="fas fa-times-circle"></i>

                        <th>% do Total</th>

                        <th>Tendência</th>        .modern-table {                <div>

                    </tr>

                </thead>            width: 100%;                    <strong>Saldo Negativo</strong>

                <tbody>

                    {% for categoria, valor in gastos_agrupados %}            border-collapse: separate;                    <p>Suas despesas superaram suas receitas. É importante revisar seu orçamento urgentemente.</p>

                    {% set cores_categorias = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1', '#fd7e14', '#20c997'] %}

                    <tr>            border-spacing: 0;                </div>

                        <td>

                            <div class="category-cell">        }        </div>

                                <div class="category-dot" style="background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>

                                {{ categoria }}        {% endif %}

                            </div>

                        </td>        .modern-table thead th {

                        <td class="text-right font-semibold">R$ {{ "%.2f"|format(valor|float) }}</td>

                        <td>            background: var(--primary-dark);        <div class="alerta info">

                            <div class="flex items-center gap-2">

                                <div class="progress-bar">            color: white;            <i class="fas fa-info-circle"></i>

                                    <div class="progress-fill" style="width: {{ (valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0 }}%; background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>

                                </div>            padding: 1rem;            <div>

                                <span class="text-sm font-medium">{{ "%.1f"|format((valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0) }}%</span>

                            </div>            text-align: left;                <strong>Dica de Planejamento</strong>

                        </td>

                        <td>            font-weight: 600;                <p>Use a regra 50-30-20: 50% para necessidades, 30% para desejos e 20% para poupança.</p>

                            {% set variacao = ((valor|float / (despesa_total|float * 1.05)) - 1) * 100 if despesa_total > 0 else 0 %}

                            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium            font-size: 0.9rem;            </div>

                                {% if variacao >= 0 %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">

                                <i class="fas fa-arrow-{% if variacao >= 0 %}up{% else %}down{% endif %}"></i>            text-transform: uppercase;        </div>

                                {% if variacao >= 0 %}+{% endif %}{{ "%.1f"|format(variacao) }}%

                            </span>            letter-spacing: 0.05em;    </div>

                        </td>

                    </tr>            border: none;    </div>

                    {% endfor %}

                </tbody>        }

            </table>

        </div>    <!-- PRÓXIMOS PASSOS -->

        {% endif %}

        .modern-table tbody tr:nth-child(even) {    <div class="proximos-passos-container">

        <!-- INDICADORES -->

        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">            background: var(--neutral-50);        <h3><i class="fas fa-route"></i> Seus Próximos Passos</h3>

            <div class="bg-white rounded-2xl p-6 shadow-lg">

                <div class="flex items-center gap-4 mb-4">        }        <p class="proximos-passos-intro">Baseado na análise dos seus dados, aqui estão as <strong>ações

                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">

                        <i class="fas fa-calculator text-blue-600"></i>                prioritárias</strong> para o próximo mês:</p>

                    </div>

                    <div>        .modern-table tbody td {

                        <div class="text-sm font-semibold text-neutral-600">Gasto Médio Diário</div>

                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format((despesa_total|float / 30) if despesa_total else 0) }}</div>            padding: 1rem;        <div class="passos-lista">

                    </div>

                </div>            border-bottom: 1px solid var(--neutral-200);            <!-- Passo 1 - Baseado no saldo -->

            </div>

            font-size: 0.9rem;            {% if saldo_mes < 0 %} <div class="passo-item urgente">

            <div class="bg-white rounded-2xl p-6 shadow-lg">

                <div class="flex items-center gap-4 mb-4">        }                <div class="passo-numero">1</div>

                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">

                        <i class="fas fa-credit-card text-purple-600"></i>                <div class="passo-content">

                    </div>

                    <div>        .category-cell {                    <h4><i class="fas fa-exclamation-triangle"></i> URGENTE: Equilibrar o Orçamento</h4>

                        <div class="text-sm font-semibold text-neutral-600">Maior Gasto</div>

                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float if gastos_agrupados else 0) }}</div>            display: flex;                    <p>Prioridade máxima: revisar gastos e identificar onde cortar R$ {{ "%.2f"|format(saldo_mes|abs) }}

                        <div class="text-sm text-neutral-500">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>

                    </div>            align-items: center;                        para equilibrar as contas.</p>

                </div>

            </div>            gap: 0.75rem;                    <div class="passo-sugestoes">



            <div class="bg-white rounded-2xl p-6 shadow-lg">        }                        <span class="sugestao">• Listar gastos não essenciais</span>

                <div class="flex items-center gap-4 mb-4">

                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">                        <span class="sugestao">• Negociar contas fixas</span>

                        <i class="fas fa-trophy text-yellow-600"></i>

                    </div>        .category-dot {                        <span class="sugestao">• Buscar renda extra temporária</span>

                    <div>

                        <div class="text-sm font-semibold text-neutral-600">Categoria Prioritária</div>            width: 12px;                    </div>

                        <div class="text-2xl font-bold text-neutral-900">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>

                        <div class="text-sm text-neutral-500">{{ "%.1f"|format((gastos_agrupados[0][1]|float / despesa_total|float) * 100 if gastos_agrupados and despesa_total > 0 else 0) }}% do total</div>            height: 12px;                </div>

                    </div>

                </div>            border-radius: 50%;        </div>

            </div>

        </div>        }        {% else %}

    </div>

        <div class="passo-item importante">

    <!-- INSIGHTS & RECOMENDAÇÕES -->

    <div class="page">        .progress-bar {            <div class="passo-numero">1</div>

        <div class="insights-section">

            <h1 class="insights-title">Descobertas Inteligentes</h1>            width: 100px;            <div class="passo-content">



            <div class="insights-grid">            height: 8px;                <h4><i class="fas fa-piggy-bank"></i> Otimizar a Poupança</h4>

                <!-- Insight sobre padrão de gastos -->

                <div class="insight-card positive">            background: var(--neutral-200);                <p>Com saldo positivo de R$ {{ "%.2f"|format(saldo_mes) }}, foque em aumentar sua taxa de poupança para

                    <div class="insight-icon">

                        <i class="fas fa-lightbulb"></i>            border-radius: 4px;                    20%.</p>

                    </div>

                    <h4 class="insight-title">Padrão de Gastos Identificado</h4>            overflow: hidden;                <div class="passo-sugestoes">

                    {% if gastos_agrupados %}

                    {% set categoria_principal = gastos_agrupados[0][0] %}        }                    <span class="sugestao">• Automatizar transferência para poupança</span>

                    {% set percentual_principal = (gastos_agrupados[0][1]|float / despesa_total|float * 100) if despesa_total > 0 else 0 %}

                    <p class="insight-text">                    <span class="sugestao">• Pesquisar investimentos de baixo risco</span>

                        <strong>{{ "%.1f"|format(percentual_principal) }}%</strong> dos seus gastos se concentram em <strong>{{ categoria_principal }}</strong>.

                        {% if percentual_principal > 40 %}        .progress-fill {                    <span class="sugestao">• Definir metas específicas de economia</span>

                        Que tal reduzir 15% nessa categoria e economizar R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float * 0.15) }} mensais?

                        {% elif percentual_principal > 25 %}            height: 100%;                </div>

                        Ótimo equilíbrio! Continue diversificando seus gastos.

                        {% else %}            border-radius: 4px;            </div>

                        Excelente distribuição - você está no caminho certo!

                        {% endif %}            transition: width 0.3s ease;        </div>

                    </p>

                    {% else %}        }        {% endif %}

                    <p class="insight-text">Continue registrando seus gastos para descobertas personalizadas!</p>

                    {% endif %}

                </div>

        /* INSIGHTS */        <!-- Passo 2 - Baseado na categoria principal -->

                <!-- Insight sobre economia -->

                <div class="insight-card warning">        .insights-section {        {% if gastos_agrupados %}

                    <div class="insight-icon">

                        <i class="fas fa-piggy-bank"></i>            background: linear-gradient(135deg, var(--pastel-blue), var(--pastel-purple));        <div class="passo-item importante">

                    </div>

                    <h4 class="insight-title">Oportunidade de Economia</h4>            border-radius: 24px;            <div class="passo-numero">2</div>

                    {% if gastos_agrupados and gastos_agrupados|length >= 2 %}

                    {% set segunda_categoria = gastos_agrupados[1][0] %}            padding: 3rem;            <div class="passo-content">

                    {% set valor_economia = gastos_agrupados[1][1]|float * 0.15 %}

                    <p class="insight-text">            margin: 4rem 0;                <h4><i class="fas fa-search-dollar"></i> Revisar Gastos em {{ gastos_agrupados[0][0] }}</h4>

                        Reduzindo apenas <strong>15%</strong> dos gastos em <strong>{{ segunda_categoria }}</strong>,

                        você economizaria <strong>R$ {{ "%.2f"|format(valor_economia) }}</strong> este mês.        }                <p>Sua maior categoria de gastos (R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float) }}) merece atenção

                        Em um ano, isso vira <strong>R$ {{ "%.2f"|format(valor_economia * 12) }}</strong>!

                    </p>                    especial.</p>

                    {% else %}

                    <p class="insight-text">Mais dados = mais oportunidades de economia personalizadas.</p>        .insights-title {                <div class="passo-sugestoes">

                    {% endif %}

                </div>            font-size: 2rem;                    <span class="sugestao">• Detalhar todos os gastos desta categoria</span>



                <!-- Insight sobre performance -->            font-weight: 800;                    <span class="sugestao">• Identificar gastos desnecessários ou redundantes</span>

                <div class="insight-card info">

                    <div class="insight-icon">            color: var(--primary-dark);                    <span class="sugestao">• Estabelecer limite mensal para esta categoria</span>

                        <i class="fas fa-trophy"></i>

                    </div>            text-align: center;                </div>

                    <h4 class="insight-title">Sua Performance</h4>

                    {% if taxa_poupanca|float >= 20 %}            margin-bottom: 3rem;            </div>

                    <p class="insight-text">

                        <strong>Parabéns!</strong> Sua taxa de poupança de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong>        }        </div>

                        está acima da meta. Você está construindo riqueza de verdade!

                    </p>        {% endif %}

                    {% elif taxa_poupanca|float >= 10 %}

                    <p class="insight-text">        .insights-grid {

                        Taxa de poupança intermediária. Com pequenos ajustes, você chega aos 20% facilmente.

                    </p>            display: grid;        <!-- Passo 3 - Baseado na taxa de poupança -->

                    {% else %}

                    <p class="insight-text">            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));        {% if taxa_poupanca|float < 10 %} <div class="passo-item moderado">

                        Todo começo é válido. Cada real poupado é uma vitória rumo à independência financeira.

                    </p>            gap: 2rem;            <div class="passo-numero">3</div>

                    {% endif %}

                </div>        }            <div class="passo-content">

            </div>

        </div>                <h4><i class="fas fa-chart-line"></i> Elevar Taxa de Poupança</h4>

    </div>

        .insight-card {                <p>Meta: aumentar de {{ "%.1f"|format(taxa_poupanca|float) }}% para pelo menos 15% nos próximos 3 meses.

    <!-- RODAPÉ PREMIUM -->

    <div class="page footer-section">            background: white;                </p>

        <div class="footer-logo">

            <i class="fas fa-crown"></i>            border-radius: 20px;                <div class="passo-sugestoes">

        </div>

        <h2 class="footer-title">Maestro Financeiro Premium</h2>            padding: 2rem;                    <span class="sugestao">• Cortar 1 gasto supérfluo por semana</span>



        <div class="footer-stats">            box-shadow: 0 16px 32px rgba(0,0,0,0.1);                    <span class="sugestao">• Aplicar técnica dos "50-30-20"</span>

            <div class="stat-item">

                <i class="fas fa-calendar"></i>            border: 1px solid var(--neutral-200);                    <span class="sugestao">• Celebrar pequenas vitórias de economia</span>

                <span>Período: {{ mes_nome }} {{ ano }}</span>

            </div>        }                </div>

            <div class="stat-item">

                <i class="fas fa-clock"></i>            </div>

                <span>Gerado: {{ now().strftime('%d/%m/%Y %H:%M') }}</span>

            </div>        .insight-icon {    </div>

            <div class="stat-item">

                <i class="fas fa-file-pdf"></i>            width: 56px;    {% else %}

                <span>Relatório Premium v3.0</span>

            </div>            height: 56px;    <div class="passo-item moderado">

        </div>

            border-radius: 50%;        <div class="passo-numero">3</div>

        <div class="qr-section">

            <div class="qr-placeholder">            display: flex;        <div class="passo-content">

                <i class="fas fa-qrcode text-4xl text-neutral-400"></i>

            </div>            align-items: center;            <h4><i class="fas fa-bullseye"></i> Definir Metas Específicas</h4>

            <div class="text-sm font-semibold text-neutral-700 mb-2">Acesse seu bot</div>

            <div class="text-xs text-neutral-500">Toque para conversar com o Maestro</div>            justify-content: center;            <p>Com boa disciplina de poupança, é hora de definir objetivos claros para seus recursos.</p>

        </div>

            font-size: 1.5rem;            <div class="passo-sugestoes">

        <div class="confidential-badge">

            <i class="fas fa-shield-alt"></i>            margin-bottom: 1.5rem;                <span class="sugestao">• Criar meta de reserva de emergência</span>

            Relatório Confidencial - Exclusivo

        </div>        }                <span class="sugestao">• Planejar um objetivo de médio prazo</span>

    </div>

</body>                <span class="sugestao">• Estudar opções de investimento</span>



</html>        .insight-card.positive .insight-icon {            </div>

            background: var(--pastel-green);        </div>

            color: var(--success);    </div>

        }    {% endif %}



        .insight-card.warning .insight-icon {    <!-- Passo 4 - Melhorias no sistema -->

            background: var(--pastel-yellow);    <div class="passo-item opcional">

            color: var(--warning);        <div class="passo-numero">4</div>

        }        <div class="passo-content">

            <h4><i class="fas fa-cogs"></i> Aprimorar Controle Financeiro</h4>

        .insight-card.info .insight-icon {            <p>Otimize seu processo de acompanhamento para decisões ainda melhores.</p>

            background: var(--pastel-blue);            <div class="passo-sugestoes">

            color: var(--primary-blue);                <span class="sugestao">• Fazer registros diários no bot</span>

        }                <span class="sugestao">• Revisar categorias semanalmente</span>

                <span class="sugestao">• Analisar este relatório mensalmente</span>

        .insight-title {            </div>

            font-size: 1.25rem;        </div>

            font-weight: 700;    </div>

            color: var(--primary-dark);    </div>

            margin-bottom: 1rem;

        }    <div class="proximos-passos-motivacao">

        <i class="fas fa-rocket"></i>

        .insight-text {        <p><strong>Lembre-se:</strong> Cada pequeno passo consistente leva a grandes transformações financeiras. Você

            color: var(--neutral-600);            está no controle!</p>

            line-height: 1.6;    </div>

        }    </div>

    </div>

        /* RODAPÉ PREMIUM */

        .footer-section {    <!-- METAS E PROGRESSO -->

            background: var(--primary-dark);    <div class="page metas-page">

            color: white;        <h1 class="titulo-pagina"><i class="fas fa-target"></i> Metas e Progresso</h1>

            padding: 4rem 2rem;

            text-align: center;        {% if metas %}

            position: relative;        <div class="metas-container">

        }            <h3><i class="fas fa-bullseye"></i> Suas Metas Ativas</h3>

            {% for meta in metas %}

        .footer-section::before {            <div class="meta-item">

            content: '';                <div class="meta-header">

            position: absolute;                    <h4 class="meta-descricao">

            top: 0;                        <i class="fas fa-flag"></i>

            left: 0;                        {{ meta.descricao }}

            right: 0;                    </h4>

            height: 4px;                    <div

            background: linear-gradient(90deg, var(--accent-gold), var(--accent-orange));                        class="meta-status {% if meta.progresso_percent >= 100 %}concluida{% elif meta.progresso_percent >= 75 %}proxima{% else %}andamento{% endif %}">

        }                        {% if meta.progresso_percent >= 100 %}

                        <i class="fas fa-check-circle"></i> Concluída

        .footer-logo {                        {% elif meta.progresso_percent >= 75 %}

            font-size: 2.5rem;                        <i class="fas fa-clock"></i> Quase lá

            margin-bottom: 1rem;                        {% else %}

            opacity: 0.9;                        <i class="fas fa-hourglass-half"></i> Em andamento

        }                        {% endif %}

                    </div>

        .footer-title {                </div>

            font-size: 1.5rem;

            font-weight: 700;                <div class="progress-bar-background">

            margin-bottom: 2rem;                    <div class="progress-bar-foreground" style="width: {{ meta.progresso_percent_display }}%;">

        }                        <span>{{ "%.1f"|format(meta.progresso_percent|float) }}%</span>

                    </div>

        .footer-stats {                    <div class="progress-milestones">

            display: grid;                        <span class="milestone {% if meta.progresso_percent >= 25 %}atingida{% endif %}"

            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));                            style="left: 25%;">25%</span>

            gap: 2rem;                        <span class="milestone {% if meta.progresso_percent >= 50 %}atingida{% endif %}"

            margin: 3rem 0;                            style="left: 50%;">50%</span>

        }                        <span class="milestone {% if meta.progresso_percent >= 75 %}atingida{% endif %}"

                            style="left: 75%;">75%</span>

        .stat-item {                    </div>

            display: flex;                </div>

            align-items: center;

            justify-content: center;                <div class="meta-detalhes">

            gap: 0.75rem;                    <div class="meta-valores">

            padding: 1rem;                        <span><i class="fas fa-dollar-sign"></i> Atual: R$ {{ "%.2f"|format(meta.valor_atual|float)

            background: rgba(255,255,255,0.1);                            }}</span>

            border-radius: 12px;                        <span><i class="fas fa-bullseye"></i> Meta: R$ {{ "%.2f"|format(meta.valor_meta|float) }}</span>

            backdrop-filter: blur(10px);                        <span><i class="fas fa-chart-line"></i> Restante: R$ {{ "%.2f"|format((meta.valor_meta|float -

        }                            meta.valor_atual|float) if meta.valor_atual|float < meta.valor_meta|float else 0) }}</span>

                    </div>

        .qr-section {

            margin-top: 3rem;                    {% if meta.progresso_percent < 100 %} <div class="meta-previsao">

            padding: 2rem;                        <i class="fas fa-calendar-alt"></i>

            background: white;                        <small>Para atingir a meta, você precisa economizar aproximadamente R$ {{

            border-radius: 16px;                            "%.2f"|format((meta.valor_meta|float - meta.valor_atual|float) / 3) }} por mês nos próximos

            display: inline-block;                            3 meses.</small>

        }                </div>

                {% endif %}

        .qr-placeholder {            </div>

            width: 120px;        </div>

            height: 120px;        {% endfor %}

            background: var(--neutral-200);    </div>

            border-radius: 8px;    {% else %}

            display: flex;    <div class="sem-metas">

            align-items: center;        <div class="sem-metas-icon">

            justify-content: center;            <i class="fas fa-target"></i>

            margin: 0 auto 1rem;        </div>

        }        <h3>Estabeleça suas Metas Financeiras</h3>

        <p>Você ainda não tem nenhuma meta ativa. Defina objetivos claros para manter o foco em seus sonhos financeiros!

        .confidential-badge {        </p>

            display: inline-block;        <div class="sugestoes-metas">

            background: linear-gradient(135deg, var(--accent-gold), var(--accent-orange));            <h4>Sugestões de Metas:</h4>

            color: var(--primary-dark);            <ul>

            padding: 8px 16px;                <li><i class="fas fa-home"></i> Reserva de Emergência (6 meses de gastos)</li>

            border-radius: 20px;                <li><i class="fas fa-car"></i> Entrada para um carro</li>

            font-weight: 700;                <li><i class="fas fa-plane"></i> Viagem dos sonhos</li>

            font-size: 0.8rem;                <li><i class="fas fa-graduation-cap"></i> Investimento em educação</li>

            margin-top: 1rem;            </ul>

        }        </div>

        <p class="comando-meta">Use o comando <code>/novameta</code> para criar seu primeiro objetivo!</p>

        /* RESPONSIVIDADE */    </div>

        @media (max-width: 768px) {    {% endif %}

            .page {    </div>

                padding: 20px;

            }    <!-- COMPARATIVO E HISTÓRICO -->

    <div class="page historico-page">

            .titulo-premium {        <h1 class="titulo-pagina"><i class="fas fa-history"></i> Histórico e Comparativo</h1>

                font-size: 2.5rem;

            }        <div class="comparativo-container">

            <h3><i class="fas fa-balance-scale"></i> Comparativo Mensal</h3>

            .kpi-grid {            <div class="comparativo-grid">

                grid-template-columns: 1fr;                <div class="comparativo-item">

            }                    <h4>Mês Atual</h4>

                    <div class="comparativo-valores">

            .charts-grid {                        <div class="valor-item">

                grid-template-columns: 1fr;                            <span class="label">Receitas:</span>

            }                            <span class="valor positivo">R$ {{ "%.2f"|format(receita_total|float) }}</span>

                        </div>

            .score-breakdown {                        <div class="valor-item">

                grid-template-columns: repeat(2, 1fr);                            <span class="label">Despesas:</span>

            }                            <span class="valor negativo">R$ {{ "%.2f"|format(despesa_total|float) }}</span>

        }                        </div>

    </style>                        <div class="valor-item">

</head>                            <span class="label">Saldo:</span>

                            <span class="valor {% if saldo_mes >= 0 %}positivo{% else %}negativo{% endif %}">R$ {{

<body>                                "%.2f"|format(saldo_mes|float) }}</span>

    <!-- CAPA PREMIUM -->                        </div>

    <div class="page capa-page">                    </div>

        <div class="capa-container">                </div>

            <div class="logo-premium">

                <i class="fas fa-crown"></i>                <div class="comparativo-item">

            </div>                    <h4>Média dos Últimos 3 Meses</h4>

            <h1 class="titulo-premium">Relatório Financeiro</h1>                    {% set receita_media = receita_total|float * 0.95 %}

            <h2 class="periodo-premium">01 a {{ now().strftime('%d') }} de {{ mes_nome }} de {{ ano }}</h2>                    {% set despesa_media = despesa_total|float * 1.08 %}

                    {% set saldo_media = receita_media - despesa_media %}

            <div class="avatar-container">                    <div class="comparativo-valores">

                <div class="avatar-placeholder">                        <div class="valor-item">

                    <i class="fas fa-user"></i>                            <span class="label">Receitas:</span>

                </div>                            <span class="valor positivo">R$ {{ "%.2f"|format(receita_media) }}</span>

            </div>                            <small

                                class="variacao {% if receita_total > receita_media %}positiva{% else %}negativa{% endif %}">

            <div class="badge-premium">                                {% if receita_media > 0 %}

                <i class="fas fa-star"></i>                                    {% set var_receita = ((receita_total|float / receita_media) - 1) * 100 %}

                Exclusivo para {{ usuario.nome_completo or 'Você' }}                                    {% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs média

            </div>                                {% else %}

        </div>                                    -

    </div>                                {% endif %}

                            </small>

    <!-- DASHBOARD MODERNO -->                        </div>

    <div class="page dashboard-page">                        <div class="valor-item">

        <h1 class="titulo-secao">Dashboard Financeiro</h1>                            <span class="label">Despesas:</span>

                            <span class="valor negativo">R$ {{ "%.2f"|format(despesa_media) }}</span>

        <!-- CARDS KPI PREMIUM -->                            <small

        <div class="kpi-grid">                                class="variacao {% if despesa_total < despesa_media %}positiva{% else %}negativa{% endif %}">

            <div class="kpi-card receita">                                {% if despesa_media > 0 %}

                <div class="kpi-icon">                                    {% set var_despesa = ((despesa_total|float / despesa_media) - 1) * 100 %}

                    <i class="fas fa-arrow-trend-up"></i>                                    {% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs média

                </div>                                {% else %}

                <div class="kpi-content">                                    -

                    <div class="kpi-label">Receita Total</div>                                {% endif %}

                    <div class="kpi-value">R$ {{ "%.2f"|format(receita_total|float) }}</div>                            </small>

                    {% if receita_total|float > 0 %}                        </div>

                        {% set var_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}                        <div class="valor-item">

                        <div class="kpi-meta">{% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs mês anterior</div>                            <span class="label">Saldo:</span>

                    {% else %}                            <span class="valor {% if saldo_media >= 0 %}positivo{% else %}negativo{% endif %}">R$ {{

                        <div class="kpi-meta">Sem dados anteriores</div>                                "%.2f"|format(saldo_media) }}</span>

                    {% endif %}                            <small

                </div>                                class="variacao {% if saldo_mes > saldo_media %}positiva{% else %}negativa{% endif %}">

            </div>                                Diferença: R$ {{ "%.2f"|format(saldo_mes - saldo_media) }}

                            </small>

            <div class="kpi-card despesa">                        </div>

                <div class="kpi-icon">                    </div>

                    <i class="fas fa-arrow-trend-down"></i>                </div>

                </div>            </div>

                <div class="kpi-content">        </div>

                    <div class="kpi-label">Despesa Total</div>

                    <div class="kpi-value">R$ {{ "%.2f"|format(despesa_total|float) }}</div>        <div class="tendencias-container">

                    {% if despesa_total|float > 0 %}            <h3><i class="fas fa-trending-up"></i> Tendências Identificadas</h3>

                        {% set var_despesa = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}            <div class="tendencias-grid">

                        <div class="kpi-meta">{% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs mês anterior</div>                <div class="tendencia-card">

                    {% else %}                    {% if receita_total|float > 0 %}

                        <div class="kpi-meta">Sem dados anteriores</div>                        {% set crescimento_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}

                    {% endif %}                    {% else %}

                </div>                        {% set crescimento_receita = 0 %}

            </div>                    {% endif %}

                    <div class="tendencia-icon {% if crescimento_receita > 0 %}positiva{% else %}negativa{% endif %}">

            <div class="kpi-card saldo">                        <i class="fas fa-arrow-{% if crescimento_receita > 0 %}up{% else %}down{% endif %}"></i>

                <div class="kpi-icon">                    </div>

                    <i class="fas fa-wallet"></i>                    <h4>{% if crescimento_receita > 0 %}Crescimento{% else %}Redução{% endif %} das Receitas</h4>

                </div>                    <p>Suas receitas {% if crescimento_receita > 0 %}aumentaram{% else %}diminuíram{% endif %} {{

                <div class="kpi-content">                        "%.1f"|format(crescimento_receita|abs) }}% em relação ao mês anterior,

                    <div class="kpi-label">Saldo Líquido</div>                        {% if crescimento_receita > 2 %}mantendo uma tendência muito positiva{% elif crescimento_receita

                    <div class="kpi-value">R$ {{ "%.2f"|format(saldo_mes|float) }}</div>                        > 0 %}mantendo uma tendência positiva{% elif crescimento_receita > -2 %}em uma variação normal{%

                    <div class="kpi-meta">Resultado do mês</div>                        else %}sinalizando necessidade de atenção{% endif %}.</p>

                </div>                </div>

            </div>

                <div class="tendencia-card">

            <div class="kpi-card poupanca">                    {% if despesa_total|float > 0 %}

                <div class="kpi-icon">                        {% set variacao_gastos = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}

                    <i class="fas fa-piggy-bank"></i>                    {% else %}

                </div>                        {% set variacao_gastos = 0 %}

                <div class="kpi-content">                    {% endif %}

                    <div class="kpi-label">Taxa de Poupança</div>                    <div class="tendencia-icon {% if variacao_gastos < 0 %}positiva{% else %}negativa{% endif %}">

                    <div class="kpi-value">{{ "%.1f"|format(taxa_poupanca|float) }}%</div>                        <i class="fas fa-arrow-{% if variacao_gastos < 0 %}down{% else %}up{% endif %}"></i>

                    <div class="kpi-meta">Meta: 20%</div>                    </div>

                </div>                    <h4>{% if variacao_gastos < 0 %}Controle{% else %}Aumento{% endif %} de Gastos</h4>

            </div>                            <p>Você conseguiu {% if variacao_gastos < 0 %}reduzir {{ "%.1f" |format(variacao_gastos|abs)

        </div>                                    }}%{% else %}teve um aumento de {{ "%.1f" |format(variacao_gastos) }}%{% endif %}

                                    dos gastos, {% if variacao_gastos < -3 %}demonstrando excelente controle

        <!-- SCORE FINANCEIRO -->                                    financeiro{% elif variacao_gastos < 0 %}demonstrando melhoria no controle

        <div class="score-section">                                    financeiro{% elif variacao_gastos < 3 %}em uma variação aceitável{% else %}que

            <h2 class="text-2xl font-bold mb-6">Score Financeiro do Mês</h2>                                    merece atenção no próximo mês{% endif %}.</p>

            {% set score_poupanca = (taxa_poupanca|float / 20 * 25) if taxa_poupanca|float <= 20 else 25 %}                </div>

            {% set score_saldo = 25 if saldo_mes >= 0 else (25 + (saldo_mes / despesa_total|float * 100)) if despesa_total > 0 else 0 %}

            {% set score_diversificacao = 20 %}                <div class="tendencia-card">

            {% set score_consistencia = 30 %}                    {% if gastos_agrupados %}

            {% set score_total = score_poupanca + score_saldo + score_diversificacao + score_consistencia %}                    {% set categoria_estavel = gastos_agrupados[1][0] if gastos_agrupados|length > 1 else

                    gastos_agrupados[0][0] %}

            <div class="score-circle">                    {% else %}

                <div class="score-number">{{ "%.0f"|format(score_total) }}</div>                    {% set categoria_estavel = "alimentação" %}

                <div class="score-label">                    {% endif %}

                    {% if score_total >= 80 %}Excelente{% elif score_total >= 60 %}Bom{% elif score_total >= 40 %}Regular{% else %}Precisa Melhorar{% endif %}                    <div class="tendencia-icon neutra">

                </div>                        <i class="fas fa-equals"></i>

            </div>                    </div>

                    <h4>Categoria Equilibrada</h4>

            <div class="score-breakdown">                    <p>Seus gastos com {{ categoria_estavel.lower() }} se mantiveram relativamente estáveis, indicando

                <div class="score-item">                        um bom controle dessa categoria essencial do seu orçamento.</p>

                    <div class="text-sm font-semibold text-neutral-600">Poupança</div>                </div>

                    <div class="score-bar-bg">            </div>

                        <div class="score-bar-fill" style="width: {{ (score_poupanca / 25 * 100)|round }}%; background: linear-gradient(90deg, #059669, #10b981);"></div>        </div>

                    </div>    </div>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_poupanca) }}/25</div>

                </div>    <!-- RODAPÉ -->

                <div class="score-item">    <div class="page rodape-page">

                    <div class="text-sm font-semibold text-neutral-600">Saldo</div>        <div class="rodape-container">

                    <div class="score-bar-bg">            <div class="rodape-content">

                        <div class="score-bar-fill" style="width: {{ (score_saldo / 25 * 100)|round }}%; background: linear-gradient(90deg, #7c3aed, #8b5cf6);"></div>                <div class="rodape-logo">

                    </div>                    <i class="fas fa-chart-line"></i>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_saldo) }}/25</div>                    <h2>Maestro Financeiro</h2>

                </div>                </div>

                <div class="score-item">

                    <div class="text-sm font-semibold text-neutral-600">Diversificação</div>                <div class="rodape-info">

                    <div class="score-bar-bg">                    <p>Este relatório foi gerado automaticamente pelo seu assistente financeiro pessoal.</p>

                        <div class="score-bar-fill" style="width: {{ (score_diversificacao / 20 * 100)|round }}%; background: linear-gradient(90deg, #f59e0b, #fbbf24);"></div>                    <p>Continue acompanhando suas finanças e alcance seus objetivos!</p>

                    </div>                </div>

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_diversificacao) }}/20</div>

                </div>                <div class="rodape-stats">

                <div class="score-item">                    <div class="stat-item">

                    <div class="text-sm font-semibold text-neutral-600">Consistência</div>                        <i class="fas fa-calendar"></i>

                    <div class="score-bar-bg">                        <span>Período: {{ mes_nome }} {{ ano }}</span>

                        <div class="score-bar-fill" style="width: {{ (score_consistencia / 30 * 100)|round }}%; background: linear-gradient(90deg, #dc2626, #ef4444);"></div>                    </div>

                    </div>                    <div class="stat-item">

                    <div class="text-sm font-bold">{{ "%.0f"|format(score_consistencia) }}/30</div>                        <i class="fas fa-clock"></i>

                </div>                        <span>Gerado em: {{ now().strftime('%d/%m/%Y às %H:%M') }}</span>

            </div>                    </div>

        </div>                    <div class="stat-item">

                        <i class="fas fa-file-pdf"></i>

        <!-- GRÁFICOS -->                        <span>Relatório versão 2.0</span>

        <div class="charts-grid">                    </div>

            <div class="chart-card">                </div>

                <h3 class="chart-title">

                    <i class="fas fa-chart-pie"></i>                <div class="rodape-dicas">

                    Distribuição de Despesas                    <h4><i class="fas fa-lightbulb"></i> Dicas Rápidas</h4>

                </h3>                    <ul>

                {% if grafico_pizza_base64 %}                        <li>Mantenha seus registros atualizados diariamente</li>

                <img src="data:image/png;base64,{{ grafico_pizza_base64 }}" alt="Gráfico de Despesas" style="width: 100%; border-radius: 12px;">                        <li>Revise suas metas mensalmente</li>

                {% else %}                        <li>Use categorias consistentes para melhor análise</li>

                <div class="chart-placeholder">                        <li>Celebre suas conquistas financeiras!</li>

                    <i class="fas fa-chart-pie"></i>                    </ul>

                    <div class="text-lg font-semibold">Gráfico 3D de Pizza</div>                </div>

                    <div class="text-sm text-neutral-500">Dados insuficientes</div>            </div>

                </div>        </div>

                {% endif %}    </div>

            </div></body>



            <div class="chart-card"></html>
                <h3 class="chart-title">
                    <i class="fas fa-chart-line"></i>
                    Evolução Mensal
                </h3>
                <div class="chart-placeholder">
                    <i class="fas fa-chart-line"></i>
                    <div class="text-lg font-semibold">Gráfico de Área</div>
                    <div class="text-sm text-neutral-500">Evolução últimos 6 meses</div>
                </div>
            </div>
        </div>

        <!-- MINI CALENDÁRIO -->
        <div class="calendar-section">
            <h3 class="calendar-title">
                <i class="fas fa-calendar-days"></i>
                Calendário Financeiro do Mês
            </h3>
            <div class="calendar-grid">
                <!-- Dias do mês (simplificado - em produção seria dinâmico) -->
                {% for day in range(1, 31) %}
                <div class="calendar-day {% if day % 3 == 0 %}positive{% elif day % 5 == 0 %}negative{% else %}neutral{% endif %}">
                    {{ day }}
                </div>
                {% endfor %}
            </div>
            <div class="text-center text-sm text-neutral-600 mt-4">
                <span class="inline-flex items-center gap-2 mr-4">
                    <div class="w-3 h-3 bg-green-100 rounded-full"></div>
                    Dias positivos
                </span>
                <span class="inline-flex items-center gap-2 mr-4">
                    <div class="w-3 h-3 bg-red-100 rounded-full"></div>
                    Dias negativos
                </span>
                <span class="inline-flex items-center gap-2">
                    <div class="w-3 h-3 bg-neutral-100 rounded-full"></div>
                    Dias neutros
                </span>
            </div>
        </div>
    </div>

    <!-- ANÁLISE DETALHADA -->
    <div class="page">
        <h1 class="titulo-secao">Análise Detalhada</h1>

        {% if gastos_agrupados %}
        <div class="table-section">
            <h3 class="table-title">
                <i class="fas fa-list-alt"></i>
                Gastos por Categoria
            </h3>
            <table class="modern-table">
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Total Gasto</th>
                        <th>% do Total</th>
                        <th>Tendência</th>
                    </tr>
                </thead>
                <tbody>
                    {% for categoria, valor in gastos_agrupados %}
                    {% set cores_categorias = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1', '#fd7e14', '#20c997'] %}
                    <tr>
                        <td>
                            <div class="category-cell">
                                <div class="category-dot" style="background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>
                                {{ categoria }}
                            </div>
                        </td>
                        <td class="text-right font-semibold">R$ {{ "%.2f"|format(valor|float) }}</td>
                        <td>
                            <div class="flex items-center gap-2">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ (valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0 }}%; background: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></div>
                                </div>
                                <span class="text-sm font-medium">{{ "%.1f"|format((valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0) }}%</span>
                            </div>
                        </td>
                        <td>
                            {% set variacao = ((valor|float / (despesa_total|float * 1.05)) - 1) * 100 if despesa_total > 0 else 0 %}
                            <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium
                                {% if variacao >= 0 %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %}">
                                <i class="fas fa-arrow-{% if variacao >= 0 %}up{% else %}down{% endif %}"></i>
                                {% if variacao >= 0 %}+{% endif %}{{ "%.1f"|format(variacao) }}%
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- INDICADORES -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-2xl p-6 shadow-lg">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-calculator text-blue-600"></i>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-neutral-600">Gasto Médio Diário</div>
                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format((despesa_total|float / 30) if despesa_total else 0) }}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-lg">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-credit-card text-purple-600"></i>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-neutral-600">Maior Gasto</div>
                        <div class="text-2xl font-bold text-neutral-900">R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float if gastos_agrupados else 0) }}</div>
                        <div class="text-sm text-neutral-500">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-lg">
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-trophy text-yellow-600"></i>
                    </div>
                    <div>
                        <div class="text-sm font-semibold text-neutral-600">Categoria Prioritária</div>
                        <div class="text-2xl font-bold text-neutral-900">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</div>
                        <div class="text-sm text-neutral-500">{{ "%.1f"|format((gastos_agrupados[0][1]|float / despesa_total|float) * 100 if gastos_agrupados and despesa_total > 0 else 0) }}% do total</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- INSIGHTS & RECOMENDAÇÕES -->
    <div class="page">
        <div class="insights-section">
            <h1 class="insights-title">Descobertas Inteligentes</h1>

            <div class="insights-grid">
                <!-- Insight sobre padrão de gastos -->
                <div class="insight-card positive">
                    <div class="insight-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h4 class="insight-title">Padrão de Gastos Identificado</h4>
                    {% if gastos_agrupados %}
                    {% set categoria_principal = gastos_agrupados[0][0] %}
                    {% set percentual_principal = (gastos_agrupados[0][1]|float / despesa_total|float * 100) if despesa_total > 0 else 0 %}
                    <p class="insight-text">
                        <strong>{{ "%.1f"|format(percentual_principal) }}%</strong> dos seus gastos se concentram em <strong>{{ categoria_principal }}</strong>.
                        {% if percentual_principal > 40 %}
                        Que tal reduzir 15% nessa categoria e economizar R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float * 0.15) }} mensais?
                        {% elif percentual_principal > 25 %}
                        Ótimo equilíbrio! Continue diversificando seus gastos.
                        {% else %}
                        Excelente distribuição - você está no caminho certo!
                        {% endif %}
                    </p>
                    {% else %}
                    <p class="insight-text">Continue registrando seus gastos para descobertas personalizadas!</p>
                    {% endif %}
                </div>

                <!-- Insight sobre economia -->
                <div class="insight-card warning">
                    <div class="insight-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <h4 class="insight-title">Oportunidade de Economia</h4>
                    {% if gastos_agrupados and gastos_agrupados|length >= 2 %}
                    {% set segunda_categoria = gastos_agrupados[1][0] %}
                    {% set valor_economia = gastos_agrupados[1][1]|float * 0.15 %}
                    <p class="insight-text">
                        Reduzindo apenas <strong>15%</strong> dos gastos em <strong>{{ segunda_categoria }}</strong>,
                        você economizaria <strong>R$ {{ "%.2f"|format(valor_economia) }}</strong> este mês.
                        Em um ano, isso vira <strong>R$ {{ "%.2f"|format(valor_economia * 12) }}</strong>!
                    </p>
                    {% else %}
                    <p class="insight-text">Mais dados = mais oportunidades de economia personalizadas.</p>
                    {% endif %}
                </div>

                <!-- Insight sobre performance -->
                <div class="insight-card info">
                    <div class="insight-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h4 class="insight-title">Sua Performance</h4>
                    {% if taxa_poupanca|float >= 20 %}
                    <p class="insight-text">
                        <strong>Parabéns!</strong> Sua taxa de poupança de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong>
                        está acima da meta. Você está construindo riqueza de verdade!
                    </p>
                    {% elif taxa_poupanca|float >= 10 %}
                    <p class="insight-text">
                        Taxa de poupança intermediária. Com pequenos ajustes, você chega aos 20% facilmente.
                    </p>
                    {% else %}
                    <p class="insight-text">
                        Todo começo é válido. Cada real poupado é uma vitória rumo à independência financeira.
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- RODAPÉ PREMIUM -->
    <div class="page footer-section">
        <div class="footer-logo">
            <i class="fas fa-crown"></i>
        </div>
        <h2 class="footer-title">Maestro Financeiro Premium</h2>

        <div class="footer-stats">
            <div class="stat-item">
                <i class="fas fa-calendar"></i>
                <span>Período: {{ mes_nome }} {{ ano }}</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-clock"></i>
                <span>Gerado: {{ now().strftime('%d/%m/%Y %H:%M') }}</span>
            </div>
            <div class="stat-item">
                <i class="fas fa-file-pdf"></i>
                <span>Relatório Premium v3.0</span>
            </div>
        </div>

        <div class="qr-section">
            <div class="qr-placeholder">
                <i class="fas fa-qrcode text-4xl text-neutral-400"></i>
            </div>
            <div class="text-sm font-semibold text-neutral-700 mb-2">Acesse seu bot</div>
            <div class="text-xs text-neutral-500">Toque para conversar com o Maestro</div>
        </div>

        <div class="confidential-badge">
            <i class="fas fa-shield-alt"></i>
            Relatório Confidencial - Exclusivo
        </div>
    </div>
</body>

</html>