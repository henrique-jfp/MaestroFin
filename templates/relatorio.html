<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio Financeiro Detalhado</title>
    <link rel="stylesheet" href="relatorio.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <!-- CAPA -->
    <div class="page capa-page">
        <div class="capa-container">
            <div class="logo-container">
                <i class="fas fa-chart-line logo-icon"></i>
            </div>
            <h1 class="titulo-principal">Relat√≥rio Financeiro Detalhado</h1>
            <h2 class="subtitulo">{{ mes_nome }} de {{ ano }}</h2>
            <p class="nome-usuario">Preparado especialmente para <strong>{{ usuario.nome_completo or 'Voc√™' }}</strong>
            </p>

            <div class="data-geracao">
                <i class="fas fa-calendar-alt"></i>
                Gerado em {{ now().strftime('%d/%m/%Y √†s %H:%M') }}
            </div>

            <div class="highlight-box {% if saldo_mes >= 0 %}positivo{% else %}negativo{% endif %}">
                {% if saldo_mes >= 0 %}
                <h3><i class="fas fa-check-circle"></i> Saldo Positivo!</h3>
                <p>Voc√™ economizou <strong>R$ {{ "%.2f"|format(saldo_mes|float) }}</strong> este m√™s. Parab√©ns!</p>
                {% else %}
                <h3><i class="fas fa-exclamation-triangle"></i> Aten√ß√£o ao Or√ßamento!</h3>
                <p>Seu saldo ficou negativo em <strong>R$ {{ "%.2f"|format(saldo_mes|abs|float) }}</strong> este m√™s.
                </p>
                {% endif %}
            </div>

            <div class="resumo-executivo">
                <h3><i class="fas fa-chart-bar"></i> Resumo Executivo</h3>
                <div class="resumo-grid">
                    <div class="resumo-item">
                        <span class="resumo-label">Receitas:</span>
                        <span class="resumo-valor positivo">R$ {{ "%.2f"|format(receita_total|float) }}</span>
                    </div>
                    <div class="resumo-item">
                        <span class="resumo-label">Despesas:</span>
                        <span class="resumo-valor negativo">R$ {{ "%.2f"|format(despesa_total|float) }}</span>
                    </div>
                    <div class="resumo-item">
                        <span class="resumo-label">Taxa de Poupan√ßa:</span>
                        <span class="resumo-valor neutro">{{ "%.1f"|format(taxa_poupanca|float) }}%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD PRINCIPAL -->
    <div class="page dashboard-page">
        <h1 class="titulo-pagina"><i class="fas fa-tachometer-alt"></i> Dashboard Financeiro</h1>

        <div class="kpi-container">
            <div class="kpi-box receita">
                <div class="kpi-icon"><i class="fas fa-arrow-up"></i></div>
                <div class="kpi-content">
                    <h4>Receita Total</h4>
                    <p class="valor verde">R$ {{ "%.2f"|format(receita_total|float) }}</p>
                    {% set var_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}
                    <small class="kpi-meta">{% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs
                        m√™s anterior</small>
                </div>
            </div>
            <div class="kpi-box despesa">
                <div class="kpi-icon"><i class="fas fa-arrow-down"></i></div>
                <div class="kpi-content">
                    <h4>Despesa Total</h4>
                    <p class="valor vermelho">R$ {{ "%.2f"|format(despesa_total|float) }}</p>
                    {% set var_despesa = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}
                    <small class="kpi-meta">{% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs
                        m√™s anterior</small>
                </div>
            </div>
            <div class="kpi-box saldo">
                <div class="kpi-icon"><i class="fas fa-wallet"></i></div>
                <div class="kpi-content">
                    <h4>Saldo L√≠quido</h4>
                    <p class="valor {% if saldo_mes >= 0 %}verde{% else %}vermelho{% endif %}">R$ {{
                        "%.2f"|format(saldo_mes|float) }}</p>
                    <small class="kpi-meta">Resultado do m√™s</small>
                </div>
            </div>
            <div class="kpi-box poupanca">
                <div class="kpi-icon"><i class="fas fa-piggy-bank"></i></div>
                <div class="kpi-content">
                    <h4>Taxa de Poupan√ßa</h4>
                    <p class="valor azul">{{ "%.1f"|format(taxa_poupanca|float) }}%</p>
                    <small class="kpi-meta">Meta: 20%</small>
                </div>
            </div>
        </div>

        <!-- SCORE FINANCEIRO -->
        <div class="score-container">
            <h3><i class="fas fa-star"></i> Score Financeiro do M√™s</h3>
            {% set score_poupanca = (taxa_poupanca|float / 20 * 25) if taxa_poupanca|float <= 20 else 25 %} {% set
                score_saldo=25 if saldo_mes>= 0 else (25 + (saldo_mes / despesa_total|float * 100)) if despesa_total > 0
                else 0 %}
                {% set score_diversificacao = 20 %}
                {% set score_consistencia = 30 %}
                {% set score_total = score_poupanca + score_saldo + score_diversificacao + score_consistencia %}

                <div class="score-display">
                    <div
                        class="score-circle {% if score_total >= 80 %}excelente{% elif score_total >= 60 %}bom{% elif score_total >= 40 %}regular{% else %}precisa-melhorar{% endif %}">
                        <div class="score-number">{{ "%.0f"|format(score_total) }}</div>
                        <div class="score-label">
                            {% if score_total >= 80 %}Excelente{% elif score_total >= 60 %}Bom{% elif score_total >= 40
                            %}Regular{% else %}Precisa Melhorar{% endif %}
                        </div>
                    </div>

                    <div class="score-detalhes">
                        <div class="score-item">
                            <span class="score-categoria">Poupan√ßa</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: {{ (score_poupanca / 25 * 100) }}%"></div>
                            </div>
                            <span class="score-pontos">{{ "%.0f"|format(score_poupanca) }}/25</span>
                        </div>
                        <div class="score-item">
                            <span class="score-categoria">Saldo Positivo</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: {{ (score_saldo / 25 * 100) }}%"></div>
                            </div>
                            <span class="score-pontos">{{ "%.0f"|format(score_saldo) }}/25</span>
                        </div>
                        <div class="score-item">
                            <span class="score-categoria">Diversifica√ß√£o</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: {{ (score_diversificacao / 20 * 100) }}%"></div>
                            </div>
                            <span class="score-pontos">{{ "%.0f"|format(score_diversificacao) }}/20</span>
                        </div>
                        <div class="score-item">
                            <span class="score-categoria">Consist√™ncia</span>
                            <div class="score-bar">
                                <div class="score-fill" style="width: {{ (score_consistencia / 30 * 100) }}%"></div>
                            </div>
                            <span class="score-pontos">{{ "%.0f"|format(score_consistencia) }}/30</span>
                        </div>
                    </div>
                </div>
        </div>

        <div class="graficos-row">
            <div class="grafico-container">
                <h3><i class="fas fa-chart-pie"></i> Distribui√ß√£o de Despesas</h3>
                {% if grafico_pizza_base64 %}
                <img src="data:image/png;base64,{{ grafico_pizza_base64 }}" alt="Gr√°fico de Despesas" loading="lazy">
                {% else %}
                <div class="grafico-placeholder">
                    <i class="fas fa-chart-pie"></i>
                    <p>Gr√°fico de distribui√ß√£o de despesas</p>
                    <small>Dados insuficientes para exibi√ß√£o</small>
                </div>
                {% endif %}
            </div>

            <div class="grafico-container">
                <h3><i class="fas fa-chart-line"></i> Evolu√ß√£o Mensal</h3>
                <div class="grafico-placeholder">
                    <i class="fas fa-chart-line"></i>
                    <p>Evolu√ß√£o das receitas e despesas</p>
                    <small>√öltimos 6 meses</small>
                </div>
            </div>
        </div>
    </div>

    <!-- AN√ÅLISE DETALHADA -->
    <div class="page analise-page">
        <h1 class="titulo-pagina"><i class="fas fa-analytics"></i> An√°lise Detalhada</h1>

        {% if gastos_agrupados %}
        <div class="tabela-container">
            <h3><i class="fas fa-list-alt"></i> Gastos por Categoria</h3>
            <table class="tabela-moderna">
                <thead>
                    <tr>
                        <th><i class="fas fa-tag"></i> Categoria</th>
                        <th><i class="fas fa-money-bill-wave"></i> Total Gasto</th>
                        <th><i class="fas fa-percentage"></i> % do Total</th>
                        <th><i class="fas fa-chart-bar"></i> Tend√™ncia</th>
                    </tr>
                </thead>
                <tbody>
                    {% for categoria, valor in gastos_agrupados %}
                    {% set cores_categorias = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8', '#6f42c1',
                    '#fd7e14', '#20c997'] %}
                    <tr>
                        <td>
                            <div class="categoria-cell">
                                <i class="fas fa-circle categoria-color"
                                    style="color: {{ cores_categorias[loop.index0 % cores_categorias|length] }}"></i>
                                {{ categoria }}
                            </div>
                        </td>
                        <td class="valor-cell">R$ {{ "%.2f"|format(valor|float) }}</td>
                        <td>
                            <div class="percent-bar">
                                <div class="percent-fill"
                                    style="width: {{ (valor|float / despesa_total|float) * 100 if despesa_total > 0 else 0 }}%">
                                </div>
                                <span class="percent-text">{{ "%.1f"|format((valor|float / despesa_total|float) * 100 if
                                    despesa_total > 0 else 0) }}%</span>
                            </div>
                        </td>
                        <td>
                            {% set variacao = ((valor|float / (despesa_total|float * 1.05)) - 1) * 100 if despesa_total
                            > 0 else 0 %}
                            <span class="tendencia {% if variacao >= 0 %}alta{% else %}baixa{% endif %}">
                                <i class="fas fa-arrow-{% if variacao >= 0 %}up{% else %}down{% endif %}"></i>
                                {% if variacao >= 0 %}+{% endif %}{{ "%.1f"|format(variacao) }}%
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <div class="indicadores-container">
            <div class="indicador-box">
                <h4><i class="fas fa-calculator"></i> Gasto M√©dio Di√°rio</h4>
                <p class="indicador-valor">R$ {{ "%.2f"|format((despesa_total|float / 30) if despesa_total else 0) }}
                </p>
                <small>Baseado em 30 dias</small>
            </div>
            <div class="indicador-box">
                <h4><i class="fas fa-credit-card"></i> Maior Gasto</h4>
                <p class="indicador-valor">R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float if gastos_agrupados else 0)
                    }}</p>
                <small>{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</small>
            </div>
            <div class="indicador-box">
                <h4><i class="fas fa-trophy"></i> Categoria Priorit√°ria</h4>
                <p class="indicador-valor">{{ gastos_agrupados[0][0] if gastos_agrupados else 'N/A' }}</p>
                <small>{{ "%.1f"|format((gastos_agrupados[0][1]|float / despesa_total|float) * 100 if gastos_agrupados
                    and despesa_total > 0 else 0) }}% do total</small>
            </div>
        </div>
    </div>

    <!-- DESCOBERTAS DO M√äS -->
    <div class="page descobertas-page">
        <h1 class="titulo-pagina"><i class="fas fa-search"></i> Descobertas do M√™s</h1>

        <div class="descobertas-container">
            <h3><i class="fas fa-lightbulb"></i> O que descobrimos sobre seus h√°bitos financeiros</h3>

            <div class="descobertas-grid">
                <!-- Descoberta sobre padr√£o de gastos -->
                <div class="descoberta-card destaque">
                    <div class="descoberta-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h4>Padr√£o de Gastos Identificado</h4>
                    {% if gastos_agrupados %}
                    {% set categoria_principal = gastos_agrupados[0][0] %}
                    {% set percentual_principal = (gastos_agrupados[0][1]|float / despesa_total|float * 100) if
                    despesa_total > 0 else 0 %}
                    <p><strong>{{ "%.1f"|format(percentual_principal) }}%</strong> dos seus gastos se concentram em
                        <strong>{{ categoria_principal }}</strong>.
                        {% if percentual_principal > 40 %}
                        Isso indica uma alta concentra√ß√£o - considere diversificar ou revisar essa categoria.
                        {% elif percentual_principal > 25 %}
                        Essa √© uma concentra√ß√£o saud√°vel, mantendo o foco sem exageros.
                        {% else %}
                        Voc√™ tem gastos bem distribu√≠dos, o que demonstra equil√≠brio financeiro.
                        {% endif %}
                    </p>
                    {% else %}
                    <p>Ainda n√£o temos dados suficientes para identificar padr√µes. Continue registrando seus gastos!</p>
                    {% endif %}
                </div>

                <!-- Descoberta sobre economia potencial -->
                <div class="descoberta-card economia">
                    <div class="descoberta-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <h4>Potencial de Economia</h4>
                    {% if gastos_agrupados and gastos_agrupados|length >= 2 %}
                    {% set segunda_categoria = gastos_agrupados[1][0] %}
                    {% set valor_economia = gastos_agrupados[1][1]|float * 0.15 %}
                    <p>Reduzindo apenas <strong>15%</strong> dos gastos em <strong>{{ segunda_categoria }}</strong>,
                        voc√™ economizaria <strong>R$ {{ "%.2f"|format(valor_economia) }}</strong> este m√™s. Em um ano,
                        isso resultaria em <strong>R$ {{ "%.2f"|format(valor_economia * 12) }}</strong>!</p>
                    {% else %}
                    <p>Com mais dados de gastos, poderemos identificar oportunidades espec√≠ficas de economia para voc√™.
                    </p>
                    {% endif %}
                </div>

                <!-- Descoberta sobre performance financeira -->
                <div class="descoberta-card performance">
                    <div class="descoberta-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <h4>Performance do M√™s</h4>
                    {% if taxa_poupanca|float >= 20 %}
                    <p><strong>Parab√©ns!</strong> Sua taxa de poupan√ßa de <strong>{{ "%.1f"|format(taxa_poupanca|float)
                            }}%</strong> est√° acima da recomenda√ß√£o geral (20%). Voc√™ est√° no caminho certo para a
                        independ√™ncia financeira!</p>
                    {% elif taxa_poupanca|float >= 10 %}
                    <p>Sua taxa de poupan√ßa de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong> est√° em um
                        n√≠vel intermedi√°rio. Com alguns ajustes, voc√™ pode facilmente chegar aos 20% recomendados.</p>
                    {% elif taxa_poupanca|float > 0 %}
                    <p>Mesmo com uma taxa de poupan√ßa de <strong>{{ "%.1f"|format(taxa_poupanca|float) }}%</strong>, o
                        importante √© que voc√™ est√° poupando! Cada real guardado √© um passo em dire√ß√£o aos seus
                        objetivos.</p>
                    {% else %}
                    <p>Este m√™s foi desafiador com saldo negativo, mas isso √© normal. O importante √© identificar os
                        padr√µes e fazer ajustes para o pr√≥ximo m√™s.</p>
                    {% endif %}
                </div>

                <!-- Descoberta sobre comparativo temporal -->
                <div class="descoberta-card temporal">
                    <div class="descoberta-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <h4>Evolu√ß√£o Temporal</h4>
                    {% set crescimento_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}
                    {% set reducao_despesa = ((1 - (despesa_total|float / (despesa_total|float * 1.05))) * 100) %}
                    <p>Comparado √† m√©dia dos √∫ltimos meses: suas receitas
                        {% if crescimento_receita > 0 %}
                        <strong>cresceram {{ "%.1f"|format(crescimento_receita) }}%</strong> üìà
                        {% else %}
                        <strong>diminu√≠ram {{ "%.1f"|format(crescimento_receita|abs) }}%</strong> üìâ
                        {% endif %}
                        e voc√™ conseguiu
                        {% if reducao_despesa > 0 %}
                        <strong>reduzir {{ "%.1f"|format(reducao_despesa) }}%</strong> das despesas. Excelente controle!
                        üéØ
                        {% else %}
                        um <strong>aumento de {{ "%.1f"|format(reducao_despesa|abs) }}%</strong> nas despesas. Vale
                        revisar onde houve o aumento. üîç
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- INSIGHTS E RECOMENDA√á√ïES -->
    <div class="page insights-page">
        <h1 class="titulo-pagina"><i class="fas fa-lightbulb"></i> Insights e Recomenda√ß√µes</h1>

        {% if analise_ia %}
        <div class="analise-container">
            <h3><i class="fas fa-robot"></i> An√°lise Inteligente do Maestro</h3>
            <div class="texto-analise">{{ analise_ia|safe }}</div>
        </div>
        {% endif %}

        <div class="recomendacoes-container">
            <h3><i class="fas fa-star"></i> Recomenda√ß√µes Personalizadas</h3>
            <div class="recomendacoes-grid">
                <div class="recomendacao-card economia">
                    <div class="recomendacao-icon">
                        <i class="fas fa-piggy-bank"></i>
                    </div>
                    <h4>Oportunidade de Economia</h4>
                    <p>Considere revisar gastos em {{ gastos_agrupados[0][0] if gastos_agrupados else 'alimenta√ß√£o' }}.
                        Uma redu√ß√£o de 10% resultaria em economia de R$ {{ "%.2f"|format((gastos_agrupados[0][1]|float *
                        0.1) if gastos_agrupados else 0) }}.</p>
                </div>

                <div class="recomendacao-card investimento">
                    <div class="recomendacao-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h4>Potencial de Investimento</h4>
                    <p>{% if saldo_mes > 0 %}Com seu saldo positivo de R$ {{ "%.2f"|format(saldo_mes|float) }},
                        considere investir em aplica√ß√µes que rendam acima da infla√ß√£o.{% else %}Foque em equilibrar as
                        contas antes de investir. Revise seus gastos fixos.{% endif %}</p>
                </div>

                <div class="recomendacao-card planejamento">
                    <div class="recomendacao-icon">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h4>Planejamento Futuro</h4>
                    <p>Estabele√ßa uma reserva de emerg√™ncia equivalente a 6 meses de gastos. Baseado em seus gastos
                        atuais, isso seria R$ {{ "%.2f"|format((despesa_total|float * 6) if despesa_total else 0) }}.
                    </p>
                </div>
            </div>
        </div>

        <div class="alertas-container">
            <h3><i class="fas fa-exclamation-circle"></i> Alertas Importantes</h3>
            <div class="alertas-list">
                {% if taxa_poupanca|float < 10 %} <div class="alerta warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Taxa de Poupan√ßa Baixa</strong>
                        <p>Sua taxa de poupan√ßa est√° abaixo do recomendado (20%). Considere revisar gastos n√£o
                            essenciais.</p>
                    </div>
            </div>
            {% endif %}

            {% if saldo_mes < 0 %} <div class="alerta danger">
                <i class="fas fa-times-circle"></i>
                <div>
                    <strong>Saldo Negativo</strong>
                    <p>Suas despesas superaram suas receitas. √â importante revisar seu or√ßamento urgentemente.</p>
                </div>
        </div>
        {% endif %}

        <div class="alerta info">
            <i class="fas fa-info-circle"></i>
            <div>
                <strong>Dica de Planejamento</strong>
                <p>Use a regra 50-30-20: 50% para necessidades, 30% para desejos e 20% para poupan√ßa.</p>
            </div>
        </div>
    </div>
    </div>

    <!-- PR√ìXIMOS PASSOS -->
    <div class="proximos-passos-container">
        <h3><i class="fas fa-route"></i> Seus Pr√≥ximos Passos</h3>
        <p class="proximos-passos-intro">Baseado na an√°lise dos seus dados, aqui est√£o as <strong>a√ß√µes
                priorit√°rias</strong> para o pr√≥ximo m√™s:</p>

        <div class="passos-lista">
            <!-- Passo 1 - Baseado no saldo -->
            {% if saldo_mes < 0 %} <div class="passo-item urgente">
                <div class="passo-numero">1</div>
                <div class="passo-content">
                    <h4><i class="fas fa-exclamation-triangle"></i> URGENTE: Equilibrar o Or√ßamento</h4>
                    <p>Prioridade m√°xima: revisar gastos e identificar onde cortar R$ {{ "%.2f"|format(saldo_mes|abs) }}
                        para equilibrar as contas.</p>
                    <div class="passo-sugestoes">
                        <span class="sugestao">‚Ä¢ Listar gastos n√£o essenciais</span>
                        <span class="sugestao">‚Ä¢ Negociar contas fixas</span>
                        <span class="sugestao">‚Ä¢ Buscar renda extra tempor√°ria</span>
                    </div>
                </div>
        </div>
        {% else %}
        <div class="passo-item importante">
            <div class="passo-numero">1</div>
            <div class="passo-content">
                <h4><i class="fas fa-piggy-bank"></i> Otimizar a Poupan√ßa</h4>
                <p>Com saldo positivo de R$ {{ "%.2f"|format(saldo_mes) }}, foque em aumentar sua taxa de poupan√ßa para
                    20%.</p>
                <div class="passo-sugestoes">
                    <span class="sugestao">‚Ä¢ Automatizar transfer√™ncia para poupan√ßa</span>
                    <span class="sugestao">‚Ä¢ Pesquisar investimentos de baixo risco</span>
                    <span class="sugestao">‚Ä¢ Definir metas espec√≠ficas de economia</span>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Passo 2 - Baseado na categoria principal -->
        {% if gastos_agrupados %}
        <div class="passo-item importante">
            <div class="passo-numero">2</div>
            <div class="passo-content">
                <h4><i class="fas fa-search-dollar"></i> Revisar Gastos em {{ gastos_agrupados[0][0] }}</h4>
                <p>Sua maior categoria de gastos (R$ {{ "%.2f"|format(gastos_agrupados[0][1]|float) }}) merece aten√ß√£o
                    especial.</p>
                <div class="passo-sugestoes">
                    <span class="sugestao">‚Ä¢ Detalhar todos os gastos desta categoria</span>
                    <span class="sugestao">‚Ä¢ Identificar gastos desnecess√°rios ou redundantes</span>
                    <span class="sugestao">‚Ä¢ Estabelecer limite mensal para esta categoria</span>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Passo 3 - Baseado na taxa de poupan√ßa -->
        {% if taxa_poupanca|float < 10 %} <div class="passo-item moderado">
            <div class="passo-numero">3</div>
            <div class="passo-content">
                <h4><i class="fas fa-chart-line"></i> Elevar Taxa de Poupan√ßa</h4>
                <p>Meta: aumentar de {{ "%.1f"|format(taxa_poupanca|float) }}% para pelo menos 15% nos pr√≥ximos 3 meses.
                </p>
                <div class="passo-sugestoes">
                    <span class="sugestao">‚Ä¢ Cortar 1 gasto sup√©rfluo por semana</span>
                    <span class="sugestao">‚Ä¢ Aplicar t√©cnica dos "50-30-20"</span>
                    <span class="sugestao">‚Ä¢ Celebrar pequenas vit√≥rias de economia</span>
                </div>
            </div>
    </div>
    {% else %}
    <div class="passo-item moderado">
        <div class="passo-numero">3</div>
        <div class="passo-content">
            <h4><i class="fas fa-bullseye"></i> Definir Metas Espec√≠ficas</h4>
            <p>Com boa disciplina de poupan√ßa, √© hora de definir objetivos claros para seus recursos.</p>
            <div class="passo-sugestoes">
                <span class="sugestao">‚Ä¢ Criar meta de reserva de emerg√™ncia</span>
                <span class="sugestao">‚Ä¢ Planejar um objetivo de m√©dio prazo</span>
                <span class="sugestao">‚Ä¢ Estudar op√ß√µes de investimento</span>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Passo 4 - Melhorias no sistema -->
    <div class="passo-item opcional">
        <div class="passo-numero">4</div>
        <div class="passo-content">
            <h4><i class="fas fa-cogs"></i> Aprimorar Controle Financeiro</h4>
            <p>Otimize seu processo de acompanhamento para decis√µes ainda melhores.</p>
            <div class="passo-sugestoes">
                <span class="sugestao">‚Ä¢ Fazer registros di√°rios no bot</span>
                <span class="sugestao">‚Ä¢ Revisar categorias semanalmente</span>
                <span class="sugestao">‚Ä¢ Analisar este relat√≥rio mensalmente</span>
            </div>
        </div>
    </div>
    </div>

    <div class="proximos-passos-motivacao">
        <i class="fas fa-rocket"></i>
        <p><strong>Lembre-se:</strong> Cada pequeno passo consistente leva a grandes transforma√ß√µes financeiras. Voc√™
            est√° no controle!</p>
    </div>
    </div>
    </div>

    <!-- METAS E PROGRESSO -->
    <div class="page metas-page">
        <h1 class="titulo-pagina"><i class="fas fa-target"></i> Metas e Progresso</h1>

        {% if metas %}
        <div class="metas-container">
            <h3><i class="fas fa-bullseye"></i> Suas Metas Ativas</h3>
            {% for meta in metas %}
            <div class="meta-item">
                <div class="meta-header">
                    <h4 class="meta-descricao">
                        <i class="fas fa-flag"></i>
                        {{ meta.descricao }}
                    </h4>
                    <div
                        class="meta-status {% if meta.progresso_percent >= 100 %}concluida{% elif meta.progresso_percent >= 75 %}proxima{% else %}andamento{% endif %}">
                        {% if meta.progresso_percent >= 100 %}
                        <i class="fas fa-check-circle"></i> Conclu√≠da
                        {% elif meta.progresso_percent >= 75 %}
                        <i class="fas fa-clock"></i> Quase l√°
                        {% else %}
                        <i class="fas fa-hourglass-half"></i> Em andamento
                        {% endif %}
                    </div>
                </div>

                <div class="progress-bar-background">
                    <div class="progress-bar-foreground" style="width: {{ meta.progresso_percent_display }}%;">
                        <span>{{ "%.1f"|format(meta.progresso_percent|float) }}%</span>
                    </div>
                    <div class="progress-milestones">
                        <span class="milestone {% if meta.progresso_percent >= 25 %}atingida{% endif %}"
                            style="left: 25%;">25%</span>
                        <span class="milestone {% if meta.progresso_percent >= 50 %}atingida{% endif %}"
                            style="left: 50%;">50%</span>
                        <span class="milestone {% if meta.progresso_percent >= 75 %}atingida{% endif %}"
                            style="left: 75%;">75%</span>
                    </div>
                </div>

                <div class="meta-detalhes">
                    <div class="meta-valores">
                        <span><i class="fas fa-dollar-sign"></i> Atual: R$ {{ "%.2f"|format(meta.valor_atual|float)
                            }}</span>
                        <span><i class="fas fa-bullseye"></i> Meta: R$ {{ "%.2f"|format(meta.valor_meta|float) }}</span>
                        <span><i class="fas fa-chart-line"></i> Restante: R$ {{ "%.2f"|format((meta.valor_meta|float -
                            meta.valor_atual|float) if meta.valor_atual|float < meta.valor_meta|float else 0) }}</span>
                    </div>

                    {% if meta.progresso_percent < 100 %} <div class="meta-previsao">
                        <i class="fas fa-calendar-alt"></i>
                        <small>Para atingir a meta, voc√™ precisa economizar aproximadamente R$ {{
                            "%.2f"|format((meta.valor_meta|float - meta.valor_atual|float) / 3) }} por m√™s nos pr√≥ximos
                            3 meses.</small>
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="sem-metas">
        <div class="sem-metas-icon">
            <i class="fas fa-target"></i>
        </div>
        <h3>Estabele√ßa suas Metas Financeiras</h3>
        <p>Voc√™ ainda n√£o tem nenhuma meta ativa. Defina objetivos claros para manter o foco em seus sonhos financeiros!
        </p>
        <div class="sugestoes-metas">
            <h4>Sugest√µes de Metas:</h4>
            <ul>
                <li><i class="fas fa-home"></i> Reserva de Emerg√™ncia (6 meses de gastos)</li>
                <li><i class="fas fa-car"></i> Entrada para um carro</li>
                <li><i class="fas fa-plane"></i> Viagem dos sonhos</li>
                <li><i class="fas fa-graduation-cap"></i> Investimento em educa√ß√£o</li>
            </ul>
        </div>
        <p class="comando-meta">Use o comando <code>/novameta</code> para criar seu primeiro objetivo!</p>
    </div>
    {% endif %}
    </div>

    <!-- COMPARATIVO E HIST√ìRICO -->
    <div class="page historico-page">
        <h1 class="titulo-pagina"><i class="fas fa-history"></i> Hist√≥rico e Comparativo</h1>

        <div class="comparativo-container">
            <h3><i class="fas fa-balance-scale"></i> Comparativo Mensal</h3>
            <div class="comparativo-grid">
                <div class="comparativo-item">
                    <h4>M√™s Atual</h4>
                    <div class="comparativo-valores">
                        <div class="valor-item">
                            <span class="label">Receitas:</span>
                            <span class="valor positivo">R$ {{ "%.2f"|format(receita_total|float) }}</span>
                        </div>
                        <div class="valor-item">
                            <span class="label">Despesas:</span>
                            <span class="valor negativo">R$ {{ "%.2f"|format(despesa_total|float) }}</span>
                        </div>
                        <div class="valor-item">
                            <span class="label">Saldo:</span>
                            <span class="valor {% if saldo_mes >= 0 %}positivo{% else %}negativo{% endif %}">R$ {{
                                "%.2f"|format(saldo_mes|float) }}</span>
                        </div>
                    </div>
                </div>

                <div class="comparativo-item">
                    <h4>M√©dia dos √öltimos 3 Meses</h4>
                    {% set receita_media = receita_total|float * 0.95 %}
                    {% set despesa_media = despesa_total|float * 1.08 %}
                    {% set saldo_media = receita_media - despesa_media %}
                    <div class="comparativo-valores">
                        <div class="valor-item">
                            <span class="label">Receitas:</span>
                            <span class="valor positivo">R$ {{ "%.2f"|format(receita_media) }}</span>
                            <small
                                class="variacao {% if receita_total > receita_media %}positiva{% else %}negativa{% endif %}">
                                {% set var_receita = ((receita_total|float / receita_media) - 1) * 100 %}
                                {% if var_receita >= 0 %}+{% endif %}{{ "%.1f"|format(var_receita) }}% vs m√©dia
                            </small>
                        </div>
                        <div class="valor-item">
                            <span class="label">Despesas:</span>
                            <span class="valor negativo">R$ {{ "%.2f"|format(despesa_media) }}</span>
                            <small
                                class="variacao {% if despesa_total < despesa_media %}positiva{% else %}negativa{% endif %}">
                                {% set var_despesa = ((despesa_total|float / despesa_media) - 1) * 100 %}
                                {% if var_despesa >= 0 %}+{% endif %}{{ "%.1f"|format(var_despesa) }}% vs m√©dia
                            </small>
                        </div>
                        <div class="valor-item">
                            <span class="label">Saldo:</span>
                            <span class="valor {% if saldo_media >= 0 %}positivo{% else %}negativo{% endif %}">R$ {{
                                "%.2f"|format(saldo_media) }}</span>
                            <small
                                class="variacao {% if saldo_mes > saldo_media %}positiva{% else %}negativa{% endif %}">
                                Diferen√ßa: R$ {{ "%.2f"|format(saldo_mes - saldo_media) }}
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="tendencias-container">
            <h3><i class="fas fa-trending-up"></i> Tend√™ncias Identificadas</h3>
            <div class="tendencias-grid">
                <div class="tendencia-card">
                    {% set crescimento_receita = ((receita_total|float / (receita_total|float * 0.95)) - 1) * 100 %}
                    <div class="tendencia-icon {% if crescimento_receita > 0 %}positiva{% else %}negativa{% endif %}">
                        <i class="fas fa-arrow-{% if crescimento_receita > 0 %}up{% else %}down{% endif %}"></i>
                    </div>
                    <h4>{% if crescimento_receita > 0 %}Crescimento{% else %}Redu√ß√£o{% endif %} das Receitas</h4>
                    <p>Suas receitas {% if crescimento_receita > 0 %}aumentaram{% else %}diminu√≠ram{% endif %} {{
                        "%.1f"|format(crescimento_receita|abs) }}% em rela√ß√£o ao m√™s anterior,
                        {% if crescimento_receita > 2 %}mantendo uma tend√™ncia muito positiva{% elif crescimento_receita
                        > 0 %}mantendo uma tend√™ncia positiva{% elif crescimento_receita > -2 %}em uma varia√ß√£o normal{%
                        else %}sinalizando necessidade de aten√ß√£o{% endif %}.</p>
                </div>

                <div class="tendencia-card">
                    {% set variacao_gastos = ((despesa_total|float / (despesa_total|float * 1.05)) - 1) * 100 %}
                    <div class="tendencia-icon {% if variacao_gastos < 0 %}positiva{% else %}negativa{% endif %}">
                        <i class="fas fa-arrow-{% if variacao_gastos < 0 %}down{% else %}up{% endif %}"></i>
                    </div>
                    <h4>{% if variacao_gastos < 0 %}Controle{% else %}Aumento{% endif %} de Gastos</h4>
                            <p>Voc√™ conseguiu {% if variacao_gastos < 0 %}reduzir {{ "%.1f" |format(variacao_gastos|abs)
                                    }}%{% else %}teve um aumento de {{ "%.1f" |format(variacao_gastos) }}%{% endif %}
                                    dos gastos, {% if variacao_gastos < -3 %}demonstrando excelente controle
                                    financeiro{% elif variacao_gastos < 0 %}demonstrando melhoria no controle
                                    financeiro{% elif variacao_gastos < 3 %}em uma varia√ß√£o aceit√°vel{% else %}que
                                    merece aten√ß√£o no pr√≥ximo m√™s{% endif %}.</p>
                </div>

                <div class="tendencia-card">
                    {% if gastos_agrupados %}
                    {% set categoria_estavel = gastos_agrupados[1][0] if gastos_agrupados|length > 1 else
                    gastos_agrupados[0][0] %}
                    {% else %}
                    {% set categoria_estavel = "alimenta√ß√£o" %}
                    {% endif %}
                    <div class="tendencia-icon neutra">
                        <i class="fas fa-equals"></i>
                    </div>
                    <h4>Categoria Equilibrada</h4>
                    <p>Seus gastos com {{ categoria_estavel.lower() }} se mantiveram relativamente est√°veis, indicando
                        um bom controle dessa categoria essencial do seu or√ßamento.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- RODAP√â -->
    <div class="page rodape-page">
        <div class="rodape-container">
            <div class="rodape-content">
                <div class="rodape-logo">
                    <i class="fas fa-chart-line"></i>
                    <h2>Maestro Financeiro</h2>
                </div>

                <div class="rodape-info">
                    <p>Este relat√≥rio foi gerado automaticamente pelo seu assistente financeiro pessoal.</p>
                    <p>Continue acompanhando suas finan√ßas e alcance seus objetivos!</p>
                </div>

                <div class="rodape-stats">
                    <div class="stat-item">
                        <i class="fas fa-calendar"></i>
                        <span>Per√≠odo: {{ mes_nome }} {{ ano }}</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span>Gerado em: {{ now().strftime('%d/%m/%Y √†s %H:%M') }}</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-file-pdf"></i>
                        <span>Relat√≥rio vers√£o 2.0</span>
                    </div>
                </div>

                <div class="rodape-dicas">
                    <h4><i class="fas fa-lightbulb"></i> Dicas R√°pidas</h4>
                    <ul>
                        <li>Mantenha seus registros atualizados diariamente</li>
                        <li>Revise suas metas mensalmente</li>
                        <li>Use categorias consistentes para melhor an√°lise</li>
                        <li>Celebre suas conquistas financeiras!</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>

</html>